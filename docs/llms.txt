# nlrx

The nlrx package provides tools to setup and execute NetLogo simulations
from R. NetLogo is a free, open-source and cross-platform modelling
environment for simulating natural and social phenomena. NetLogo focuses
on implementation of agent-based and spatially explicit simulation
models, although system dynamics models are supported as well. NetLogo
is developed and maintained at the Center for Connected Learning and
Computer-Based Modeling, Northwestern University, Evanston, IL. More
details on NetLogo itself are available online: [NetLogo online
documentation](https://docs.netlogo.org)

NetLogo comes with the built-in experiment tool [Behavior
Space](https://docs.netlogo.org/behaviorspace.html) that allows to setup
and execute model simulations with different settings and parameter
variations and to collect model output. This experiment tool can be
executed via command line in combination with an XML file that contains
the experiment specifications, such as runtime, variables, output
measurements, stop conditions, and more. One limitation of Behavior
Space is, that it only supports full-factorial parameter designs, which
may not be appropriate for complex model analyses. Furthermore, Behavior
Space experiment specifications are stored within the NetLogo file and
are not easily accessible from R. However, in many cases it is useful to
store such specifications along with the model output and analyses
results in order to enable fully reproducible model analyses.

The nlrx package utilizes the commandline functionality of Behavior
Space to execute NetLogo simulations directly from R. Instead of
defining experiments within NetLogo Behavior Space, experiments are
defined in R using the class objects of the nlrx package. These class
objects hold all the information that is needed to run these experiments
remotely from R, such as path to NetLogo installation folder, path to
the model file and the experiment specifications itself. nlrx provides
useful helper functions to generate parameter input matrices from
parameter range definitions that cover a wide range of parameter
exploration approaches. By storing all relevant information on
simulation experiments, including the output of the model simulations in
one class object, experiments can be easily stored and shared.

In summary, the nlrx package uses a similar structure as NetLogos
Behavior Space but offers more flexibility and additional tools for
running reproducible complex model analyses directly from R.

## Publication

Further information on the package functionality and detailed code
examples can be found in our accompanying publication: Salecker J,
Sciaini M, Meyer KM, Wiegand K. The nlrx r package: A next-generation
framework for reproducible NetLogo model analyses. Methods Ecol Evol.
2019;2041-210X. <https://doi.org/10.1111/2041-210X.13286>.

Get citation information for `nlrx` in R doing
`citation(package = 'nlrx')`.

## Prerequirements

### NetLogo

In order to use the nlrx package, [NetLogo](http://netlogoweb.org/)
(\>=5.3.1) needs to be installed on the system that is used to execute
model simulations (local/remote). For remote execution, NetLogo needs to
be installed on remote machines as well. The nlrx package provides a
utility function
([`download_netlogo()`](https://docs.ropensci.org/nlrx/reference/download_netlogo.md))
that can be used to download and unzip (only unix systems) a specified
NetLogo version to a local folder. For windows machines, the downloaded
file needs to be executed in order to install NetLogo on the local
system. If you are running MacOS, please use the Linux tar.gz version of
NetLogo (either from the NetLogo Homepage or by using the
[`download_netlogo()`](https://docs.ropensci.org/nlrx/reference/download_netlogo.md)
function). The dmg version from the NetLogo homepage is not compatible
with nlrx.

All code snippets on this homepage should be compatible with Netlogo \<=
6.2.2. In version 6.3.0, the folder structure of NetLogo was slightly
updated, thus the modelpath in the code snippets need to be adjusted
accordingly (the `"app/"` folder needs to be removed from the
modelpath).

### Java

Because NetLogo is executed in a Java virtual machine, Java needs to be
installed on the local/remote system as well. We recommend the [Oracle
Java SE Development Kit
8](https://www.oracle.com/java/technologies/javase/javase-jdk8-downloads.html)
or the [openjdk](https://github.com/ojdkbuild/ojdkbuild). While the nlrx
package might work without setting the Java system path explicitly, we
recommend to make sure that JAVA_HOME points to the correct Java
installation of the system.

## Installation

You can install the released version of nlrx from
[CRAN](https://CRAN.R-project.org) with:

``` r
install.packages("nlrx")
```

And the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("remotes")
remotes::install_github("ropensci/nlrx")
```

## Get started

General information that is needed to run NetLogo simulations remotely,
such as path to the NetLogo installation folder is stored within a `nl`
class object. Nested within this `nl` class are the classes `experiment`
and `simdesign`. The `experiment` class stores all experiment
specifications. After attaching a valid experiment, a `simdesign` class
object can be attached to the `nl` class object, by using one of the
simdesign helper functions. These helper functions create different
parameter input matrices from the experiment variable definitions that
can then be executed by the
[`run_nl_one()`](https://docs.ropensci.org/nlrx/reference/run_nl_one.md)
and
[`run_nl_all()`](https://docs.ropensci.org/nlrx/reference/run_nl_all.md)
functions. The nested design allows to store everything related to the
experiment within one R object. Additionally, different simdesign helper
functions can be applied to the same `nl` object in order to repeat the
same experiment with different parameter exploration methods
(simdesigns).

### Step by step application example

The “Wolf Sheep Predation” model from the NetLogo models library is used
to present a basic example on how to setup and run NetLogo model
simulations from R.

#### Step 1: Create a nl object:

The nl object holds all information on the NetLogo version, a path to
the NetLogo directory with the defined version, a path to the model
file, and the desired memory for the java virtual machine. Depending on
the operation system, paths to NetLogo and the model need to be
adjusted.

``` r
library(nlrx)
# Windows default NetLogo installation path (adjust to your needs!):
netlogopath <- file.path("C:/Program Files/NetLogo 6.0.3")
modelpath <- file.path(netlogopath, "app/models/Sample Models/Biology/Wolf Sheep Predation.nlogo")
outpath <- file.path("C:/out")
# Unix default NetLogo installation path (adjust to your needs!):
netlogopath <- file.path("/home/NetLogo 6.0.3")
modelpath <- file.path(netlogopath, "app/models/Sample Models/Biology/Wolf Sheep Predation.nlogo")
outpath <- file.path("/home/out")

nl <- nl(nlversion = "6.0.3",
         nlpath = netlogopath,
         modelpath = modelpath,
         jvmmem = 1024)
```

#### Step 2: Attach an experiment

The experiment object is organized in a similar fashion as NetLogo
Behavior Space experiments. It contains all information that is needed
to generate a simulation parameter matrix and to execute the NetLogo
simulations. Details on the specific slots of the experiment class can
be found in the package documentation
([`?experiment`](https://docs.ropensci.org/nlrx/reference/experiment.md))
and the “Advanced configuration” vignette.

``` r
nl@experiment <- experiment(expname="wolf-sheep",
                            outpath=outpath,
                            repetition=1,
                            tickmetrics="true",
                            idsetup="setup",
                            idgo="go",
                            runtime=50,
                            evalticks=seq(40,50),
                            metrics=c("count sheep", "count wolves", "count patches with [pcolor = green]"),
                            variables = list('initial-number-sheep' = list(min=50, max=150, qfun="qunif"),
                                             'initial-number-wolves' = list(min=50, max=150, qfun="qunif")),
                            constants = list("model-version" = "\"sheep-wolves-grass\"",
                                             "grass-regrowth-time" = 30,
                                             "sheep-gain-from-food" = 4,
                                             "wolf-gain-from-food" = 20,
                                             "sheep-reproduce" = 4,
                                             "wolf-reproduce" = 5,
                                             "show-energy?" = "false"))
```

#### Step 3: Attach a simulation design

While the experiment defines the variables and specifications of the
model, the simulation design creates a parameter input table based on
these model specifications and the chosen simulation design method. nlrx
provides a bunch of different simulation designs, such as
full-factorial, latin-hypercube, sobol, morris and eFast (see “Simdesign
Examples” vignette for more information on simdesigns). All simdesign
helper functions need a properly defined nl object with a valid
experiment design. Each simdesign helper also allows to define a number
of random seeds that are randomly generated and can be used to execute
repeated simulations of the same parameter matrix with different
random-seeds (see “Advanced configuration” vignette for more information
on random-seed and repetition management). A simulation design is
attached to a nl object by using one of the simdesign helper functions:

``` r
nl@simdesign <- simdesign_lhs(nl=nl,
                               samples=100,
                               nseeds=3,
                               precision=3)
```

#### Step 4: Run simulations

All information that is needed to run the simulations is now stored
within the nl object. The
[`run_nl_one()`](https://docs.ropensci.org/nlrx/reference/run_nl_one.md)
function allows to run one specific simulation from the siminput
parameter table. The
[`run_nl_all()`](https://docs.ropensci.org/nlrx/reference/run_nl_all.md)
function runs a loop over all simseeds and rows of the parameter input
table siminput. The loops are constructed in a way that allows easy
parallelisation, either locally or on remote HPC machines (see “Advanced
configuration” vignette for more information on parallelisation). Before
running your simulations you might want to check your current nl object
setup. `eval_variables_constants(nl)` evaluates if the defined variables
and constants are correctly defined and are consistent with the attached
model. `print(nl)` prints a complete summary of the provided nl object
including checkmarks that might help to indicate potential problems.

``` r
# Evaluate nl object:
eval_variables_constants(nl)
print(nl)

# Run all simulations (loop over all siminputrows and simseeds)
results <- run_nl_all(nl)
```

#### Step 5: Attach results to nl and run analysis

nlrx provides method specific analysis functions for each simulation
design. Depending on the chosen design, the function reports a tibble
with aggregated results or sensitivity indices. In order to run the
analyze_nl function, the simulation output has to be attached to the nl
object first. The simdesign class within the nl object provides a slot
for attaching output results (simoutput). An output results tibble can
be attached to this slot by using the simdesign setter function
`setsim(nl, "simoutput")`. After attaching the simulation results, these
can also be written to the defined outpath of the experiment object.

``` r
# Attach results to nl object:
setsim(nl, "simoutput") <- results

# Write output to outpath of experiment within nl
write_simoutput(nl)

# Do further analysis:
analyze_nl(nl)
```

## Meta

- Please [report any issues or
  bugs](https://github.com/ropensci/nlrx/issues/new).
- License: GPL3
- Get citation information for `nlrx` in R doing
  `citation(package = 'nlrx')`
- We are very open to contributions - if you are interested check
  [Contributing](https://github.com/ropensci/nlrx/blob/master/CONTRIBUTING.md).
  - Please note that this project is released with a [Contributor Code
    of
    Conduct](https://github.com/ropensci/nlrx/blob/master/CODE_OF_CONDUCT.md).
    By participating in this project you agree to abide by its terms.

# Package index

## All functions

- [`analyze_nl()`](https://docs.ropensci.org/nlrx/reference/analyze_nl.md)
  : Analyze NetLogo simulation output
- [`check_netlogo_version()`](https://docs.ropensci.org/nlrx/reference/check_netlogo_version.md)
  : Check supported NetLogo versions
- [`download_netlogo()`](https://docs.ropensci.org/nlrx/reference/download_netlogo.md)
  : Download NetLogo
- [`eval_simoutput()`](https://docs.ropensci.org/nlrx/reference/eval_simoutput.md)
  : Evaluate input/output integrity
- [`eval_variables_constants()`](https://docs.ropensci.org/nlrx/reference/eval_variables_constants.md)
  : Evaluate variable validity
- [`experiment()`](https://docs.ropensci.org/nlrx/reference/experiment.md)
  : Construct a new experiment object
- [`export_nl()`](https://docs.ropensci.org/nlrx/reference/export_nl.md)
  : Export NetLogo Experiment
- [`getexp()`](https://docs.ropensci.org/nlrx/reference/getexp.md) :
  Getter function to get a variable of an experiment object
- [`getnl()`](https://docs.ropensci.org/nlrx/reference/getnl.md) :
  Getter function to get a variable of a nl object
- [`getsim()`](https://docs.ropensci.org/nlrx/reference/getsim.md) :
  Getter function to get a variable of a simdesign object
- [`import_nl()`](https://docs.ropensci.org/nlrx/reference/import_nl.md)
  : Import NetLogo Experiment
- [`nl()`](https://docs.ropensci.org/nlrx/reference/nl.md) : Construct a
  new nl object
- [`nl_distinct`](https://docs.ropensci.org/nlrx/reference/nl_distinct.md)
  : Wolf Sheep model sample data: simdesign distinct
- [`nl_eFast`](https://docs.ropensci.org/nlrx/reference/nl_eFast.md) :
  Wolf Sheep model sample data: simdesign eFast
- [`nl_ff`](https://docs.ropensci.org/nlrx/reference/nl_ff.md) : Wolf
  Sheep model sample data: simdesign ff
- [`nl_gensa`](https://docs.ropensci.org/nlrx/reference/nl_gensa.md) :
  Wolf Sheep model sample data: gensa
- [`nl_lhs`](https://docs.ropensci.org/nlrx/reference/nl_lhs.md) : Wolf
  Sheep model sample data: simdesign lhs
- [`nl_morris`](https://docs.ropensci.org/nlrx/reference/nl_morris.md) :
  Wolf Sheep model sample data: simdesign morris
- [`nl_simple`](https://docs.ropensci.org/nlrx/reference/nl_simple.md) :
  Wolf Sheep model sample data: simdesign simple
- [`nl_sobol`](https://docs.ropensci.org/nlrx/reference/nl_sobol.md) :
  Wolf Sheep model sample data: simdesign sobol
- [`nl_sobol2007`](https://docs.ropensci.org/nlrx/reference/nl_sobol2007.md)
  : Wolf Sheep model sample data: simdesign sobol2007
- [`nl_soboljansen`](https://docs.ropensci.org/nlrx/reference/nl_soboljansen.md)
  : Wolf Sheep model sample data: simdesign soboljansen
- [`nl_spatial`](https://docs.ropensci.org/nlrx/reference/nl_spatial.md)
  : Wolf Sheep model sample data: spatial
- [`nl_to_graph()`](https://docs.ropensci.org/nlrx/reference/nl_to_graph.md)
  : Generate igraph objects from measured turtles and links metrics
- [`nl_to_points()`](https://docs.ropensci.org/nlrx/reference/nl_to_points.md)
  : Get spatial data from metrics.turtles output
- [`nl_to_raster()`](https://docs.ropensci.org/nlrx/reference/nl_to_raster.md)
  : Get spatial data from metrics.patches output
- [`nldoc()`](https://docs.ropensci.org/nlrx/reference/nldoc.md) :
  Create NetLogo documentation
- [`nldoc_network()`](https://docs.ropensci.org/nlrx/reference/nldoc_network.md)
  : Create NetLogo procedure network
- [`nlrx`](https://docs.ropensci.org/nlrx/reference/nlrx-package.md)
  [`nlrx-package`](https://docs.ropensci.org/nlrx/reference/nlrx-package.md)
  : nlrx: A package for running NetLogo simulations from R.
- [`print(`*`<nl>`*`)`](https://docs.ropensci.org/nlrx/reference/print.nl.md)
  : Print content of nl object
- [`report_model_parameters()`](https://docs.ropensci.org/nlrx/reference/report_model_parameters.md)
  : Report globals from a NetLogo model that is defined within a nl
  object
- [`run_nl_all()`](https://docs.ropensci.org/nlrx/reference/run_nl_all.md)
  : Execute all NetLogo simulations from a nl object
- [`run_nl_dyn()`](https://docs.ropensci.org/nlrx/reference/run_nl_dyn.md)
  : Execute NetLogo simulation without pregenerated parametersets
- [`run_nl_one()`](https://docs.ropensci.org/nlrx/reference/run_nl_one.md)
  : Execute one NetLogo simulation from a nl object
- [`` `setexp<-`() ``](https://docs.ropensci.org/nlrx/reference/setexp.md)
  : Setter function to set a variable of an experiment object
- [`` `setnl<-`() ``](https://docs.ropensci.org/nlrx/reference/setnl.md)
  : Setter function to set a variable of a nl object
- [`` `setsim<-`() ``](https://docs.ropensci.org/nlrx/reference/setsim.md)
  : Setter function to set a variable of a simdesign object
- [`simdesign()`](https://docs.ropensci.org/nlrx/reference/simdesign.md)
  : Construct a new simdesign object
- [`simdesign_ABCmcmc_Marjoram()`](https://docs.ropensci.org/nlrx/reference/simdesign_ABCmcmc_Marjoram.md)
  : Add an Approximate Bayesian Computation (Monte-Carlo Markov-Chain)
  simdesign using the Majoram algorithm to a nl object
- [`simdesign_ABCmcmc_Marjoram_original()`](https://docs.ropensci.org/nlrx/reference/simdesign_ABCmcmc_Marjoram_original.md)
  : Add an Approximate Bayesian Computation (Monte-Carlo Markov-Chain)
  simdesign using the Majoram Original algorithm to a nl object
- [`simdesign_ABCmcmc_Wegmann()`](https://docs.ropensci.org/nlrx/reference/simdesign_ABCmcmc_Wegmann.md)
  : Add an Approximate Bayesian Computation (Monte-Carlo Markov-Chain)
  simdesign using the Wegmann algorithm to a nl object
- [`simdesign_GenAlg()`](https://docs.ropensci.org/nlrx/reference/simdesign_GenAlg.md)
  : Add a Genetic Algorithm simdesign to a nl object
- [`simdesign_GenSA()`](https://docs.ropensci.org/nlrx/reference/simdesign_GenSA.md)
  : Add a Simulated Annealing simdesign to a nl object
- [`simdesign_distinct()`](https://docs.ropensci.org/nlrx/reference/simdesign_distinct.md)
  : Add a distinct simdesign to a nl object
- [`simdesign_eFast()`](https://docs.ropensci.org/nlrx/reference/simdesign_eFast.md)
  : Add an eFast simdesign to a nl object
- [`simdesign_ff()`](https://docs.ropensci.org/nlrx/reference/simdesign_ff.md)
  : Add a full-factorial simdesign to a nl object
- [`simdesign_lhs()`](https://docs.ropensci.org/nlrx/reference/simdesign_lhs.md)
  : Add a latin-hypercube simdesign to a nl object
- [`simdesign_morris()`](https://docs.ropensci.org/nlrx/reference/simdesign_morris.md)
  : Add a morris elementary effects simdesign to a nl object
- [`simdesign_simple()`](https://docs.ropensci.org/nlrx/reference/simdesign_simple.md)
  : Add a simple simdesign to a nl object
- [`simdesign_sobol()`](https://docs.ropensci.org/nlrx/reference/simdesign_sobol.md)
  : Add a sobol simdesign to a nl object
- [`simdesign_sobol2007()`](https://docs.ropensci.org/nlrx/reference/simdesign_sobol2007.md)
  : Add a sobol2007 simdesign to a nl object
- [`simdesign_soboljansen()`](https://docs.ropensci.org/nlrx/reference/simdesign_soboljansen.md)
  : Add a soboljansen simdesign to a nl object
- [`supported_netlogo_versions()`](https://docs.ropensci.org/nlrx/reference/supported_netlogo_versions.md)
  : Report supported NetLogo versions
- [`test_nlrx()`](https://docs.ropensci.org/nlrx/reference/test_nlrx.md)
  : Test if nlrx runs on the local system
- [`unnest_simoutput()`](https://docs.ropensci.org/nlrx/reference/unnest_simoutput.md)
  : Get spatial data from metrics.turtles and metrics.patches output
- [`write_simoutput()`](https://docs.ropensci.org/nlrx/reference/write_simoutput.md)
  : Write attached NetLogo simulation output to file

# Articles

### All vignettes

- [Approximate Bayesian Computation
  (ABC)](https://docs.ropensci.org/nlrx/articles/abc.md):
- [Advanced
  configuration](https://docs.ropensci.org/nlrx/articles/furthernotes.md):
- [Get Started](https://docs.ropensci.org/nlrx/articles/getstarted.md):
- [Interfacing a variety of different NetLogo
  models](https://docs.ropensci.org/nlrx/articles/interfacing-different-models.md):
- [Capturing NetLogo output
  manually](https://docs.ropensci.org/nlrx/articles/manual-output.md):
- [NetLogo documentation with
  nlrx](https://docs.ropensci.org/nlrx/articles/nlrx_nldoc.md):
- [Publication
  record](https://docs.ropensci.org/nlrx/articles/nlrx_papers.md):
- [Optimization](https://docs.ropensci.org/nlrx/articles/optimization.md):
- [Sensitivity
  Analysis](https://docs.ropensci.org/nlrx/articles/sensitivity.md):
- [Simdesign
  examples](https://docs.ropensci.org/nlrx/articles/simdesign-examples.md):
- [Spatial
  Output](https://docs.ropensci.org/nlrx/articles/spatial-output.md):
