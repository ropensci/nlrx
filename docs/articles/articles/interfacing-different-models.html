<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interfacing a variety of different NetLogo models • nlrx | NetLogo from R</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Interfacing a variety of different NetLogo models">
<meta property="og:description" content="nlrx">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">nlrx | NetLogo from R</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../articles/getstarted.html">
    <span class="fa fa fa fa-magic"></span>
     
    Get Started
  </a>
</li>
<li>
  <a href="../../articles/furthernotes.html">
    <span class="fa fa-book"></span>
     
    Advanced configuration
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-graduation-cap"></span>
     
    More
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/articles/spatial-output.html">
        <span class="fa fa-book"></span>
         
        Capturing spatial NetLogo output
      </a>
    </li>
    <li>
      <a href="../../articles/articles/manual-output.html">
        <span class="fa fa-book"></span>
         
        Capturing NetLogo output manually
      </a>
    </li>
    <li>
      <a href="../../articles/sensitivity.html">
        <span class="fa fa-wrench"></span>
         
        Sensitivity Analysis with nlrx
      </a>
    </li>
    <li>
      <a href="../../articles/optimization.html">
        <span class="fa fa-wrench"></span>
         
        Optimization with nlrx
      </a>
    </li>
    <li>
      <a href="../../articles/abc.html">
        <span class="fa fa-wrench"></span>
         
        Approximate Bayesian Computation (ABC) with nlrx
      </a>
    </li>
    <li>
      <a href="../../articles/simdesign-examples.html">
        <span class="fa fa-wrench"></span>
         
        Simdesign examples
      </a>
    </li>
    <li>
      <a href="../../articles/articles/interfacing-different-models.html">
        <span class="fa fa-wrench"></span>
         
        Interfacing a variety of different NetLogo models
      </a>
    </li>
    <li>
      <a href="../../articles/articles/nlrx_nldoc.html">
        <span class="fa fa-wrench"></span>
         
        NetLogo documentation with nlrx
      </a>
    </li>
    <li>
      <a href="../../articles/articles/nlrx_papers.html">
        <span class="fa fa-bookmark"></span>
         
        Publication record
      </a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../../news/index.html">
    <span class="fa fa-newspaper"></span>
     
    news
  </a>
</li>
<li>
  <a href="../../reference/index.html">
    <span class="fa fa-cogs"></span>
     
    functions
  </a>
</li>
<li>
  <a href="https://github.com/ropensci/nlrx">
    <span class="fab fa fab fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="interfacing-different-models_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Interfacing a variety of different NetLogo models</h1>
                        <h4 class="author">Marco Sciaini</h4>
            
            <h4 class="date">2021-01-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/nlrx/blob/master/vignettes/articles/interfacing-different-models.Rmd"><code>vignettes/articles/interfacing-different-models.Rmd</code></a></small>
      <div class="hidden name"><code>interfacing-different-models.Rmd</code></div>

    </div>

    
    
<p>Here, we present examples on how to interface a variety of different NetLogo models. NetLogo model interfaces are very diverse across models and might contain spatial elements of different types (patches, different groups of turtles, links). With our interfacing examples, we try to cover a wide range of different models to show how <strong>nlrx</strong> can be utilized for various applications.</p>
<p>Our examples show how spatial output from NetLogo models can be used to create animated gif files, displaying patches and turtles properties over time. We explicitly show how to setup, postprocess and plot spatial output for very different model types. Although, the following examples cover a wide range of output types, it is likely that different experiment measurements or postprocessing needs to be done for specific and complex models. If you have problems to interface a specific type of model, feel free to send one of the authors of nlrx an email!</p>
<p>First, we need to load a bunch of packages, mainly for the subsetting of the spatial data and the plotting:</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co">## Load packages</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">nlrx</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">tidyverse</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">gganimate</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">cartography</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">rcartocolor</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggthemes</span>)</pre></body></html></div>
<p>Second, we need to define the path variables pointing to the NetLogo installation. Depending on the operation system, the NetLogo and output paths need to be adjusted.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># Windows default NetLogo installation path (adjust to your needs!):</span>
<span class="no">netlogopath</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"C:/Program Files/NetLogo 6.0.4"</span>)
<span class="no">outpath</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"C:/out"</span>)
<span class="co"># Unix default NetLogo installation path (adjust to your needs!):</span>
<span class="no">netlogopath</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"/home/NetLogo 6.0.4"</span>)
<span class="no">outpath</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="st">"/home/out"</span>)</pre></body></html></div>
<p>… and now are ready to interface some of the models of the NetLogo model library.</p>
<div id="diffusion-model" class="section level2">
<h2 class="hasAnchor">
<a href="#diffusion-model" class="anchor"></a>Diffusion model</h2>
<p>The diffusion model is a simple example of how to plot moving turtles and patches. Turtles move over the lattice and generate heat on cells they move over. The accumulated heat also diffuses to neighboring cells.</p>
<p>In order to transfer the spatial information from NetLogo to R, we measure the who number and coordinates of all turtles (metrics.turtles) and coordinates, patch color and amount of heat of all patches (metrics.patches).</p>
<p>After converting the spatial data to tibble format (<code><a href="../../reference/unnest_simoutput.html">unnest_simoutput()</a></code>), we split the spatial data into a turtles tibble and a patches tibble using the agent column of the returned tibble from <code><a href="../../reference/unnest_simoutput.html">unnest_simoutput()</a></code>. The plot consist of a geom_tile layer, which displays the amount of heat in each cell and a geom_point layer that displays the movement of the turtles. In order to render animated gifs with gganimate it is very important to set the group property of the turtles layer correctly (group=who).</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co">## Step1: Create a nl obejct:</span>
<span class="no">nl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/nl.html">nl</a></span>(<span class="kw">nlversion</span> <span class="kw">=</span> <span class="st">"6.0.4"</span>,
         <span class="kw">nlpath</span> <span class="kw">=</span> <span class="no">netlogopath</span>,
         <span class="kw">modelpath</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">netlogopath</span>, <span class="st">"app/models/Sample Models/Art/Diffusion Graphics.nlogo"</span>),
         <span class="kw">jvmmem</span> <span class="kw">=</span> <span class="fl">1024</span>)

<span class="co">## Step2: Add Experiment</span>
<span class="no">nl</span>@<span class="kw">experiment</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/experiment.html">experiment</a></span>(<span class="kw">expname</span> <span class="kw">=</span> <span class="st">"diffusion"</span>,
                            <span class="kw">outpath</span> <span class="kw">=</span> <span class="no">outpath</span>,
                            <span class="kw">repetition</span> <span class="kw">=</span> <span class="fl">1</span>,
                            <span class="kw">tickmetrics</span> <span class="kw">=</span> <span class="st">"true"</span>,
                            <span class="kw">idsetup</span> <span class="kw">=</span> <span class="st">"setup"</span>,
                            <span class="kw">idgo</span> <span class="kw">=</span> <span class="st">"go"</span>,
                            <span class="kw">runtime</span> <span class="kw">=</span> <span class="fl">500</span>,
                            <span class="kw">evalticks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>,<span class="fl">500</span>),
                            <span class="kw">constants</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"num-turtles"</span> <span class="kw">=</span> <span class="fl">20</span>,
                                             <span class="st">"diffusion-rate"</span> <span class="kw">=</span> <span class="fl">1</span>,
                                             <span class="st">"turtle-heat"</span> <span class="kw">=</span> <span class="fl">139</span>,
                                             <span class="st">"turtle-speed"</span> <span class="kw">=</span> <span class="fl">1.0</span>,
                                             <span class="st">"wander?"</span> <span class="kw">=</span> <span class="st">"TRUE"</span>),
                            <span class="kw">metrics.turtles</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"turtles"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"who"</span>, <span class="st">"xcor"</span>, <span class="st">"ycor"</span>)),
                            <span class="kw">metrics.patches</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"pxcor"</span>, <span class="st">"pycor"</span>, <span class="st">"pcolor"</span>, <span class="st">"heat"</span>))

<span class="co"># Evaluate if variables and constants are valid:</span>
<span class="fu"><a href="../../reference/eval_variables_constants.html">eval_variables_constants</a></span>(<span class="no">nl</span>)

<span class="co">## Step3: Add a Simulation Design</span>
<span class="no">nl</span>@<span class="kw">simdesign</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/simdesign_simple.html">simdesign_simple</a></span>(<span class="kw">nl</span> <span class="kw">=</span> <span class="no">nl</span>,
                                 <span class="kw">nseeds</span> <span class="kw">=</span> <span class="fl">1</span>)


<span class="co"># Step4: Run simulations:</span>
<span class="no">results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/run_nl_all.html">run_nl_all</a></span>(<span class="kw">nl</span> <span class="kw">=</span> <span class="no">nl</span>)

<span class="co">## Postprocessing:</span>
<span class="co">## Step1: Attach results to nl:</span>
<span class="fu"><a href="../../reference/setsim.html">setsim</a></span>(<span class="no">nl</span>, <span class="st">"simoutput"</span>) <span class="kw">&lt;-</span> <span class="no">results</span>


<span class="co"># Prepare data for plotting</span>
<span class="no">nl_spatial</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/unnest_simoutput.html">unnest_simoutput</a></span>(<span class="no">nl</span>)
<span class="no">n</span> <span class="kw">&lt;-</span> <span class="no">nl</span>@<span class="kw">experiment</span>@<span class="kw">runtime</span>

<span class="no">turtles</span> <span class="kw">&lt;-</span> <span class="no">nl_spatial</span> <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">agent</span> <span class="kw">==</span> <span class="st">"turtles"</span> <span class="kw">&amp;</span> <span class="no">`[step]`</span> <span class="kw">&lt;</span> <span class="no">n</span>) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">xcor</span>, <span class="no">ycor</span>, <span class="no">`[step]`</span>, <span class="no">who</span>)
<span class="no">patches</span> <span class="kw">&lt;-</span> <span class="no">nl_spatial</span> <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">agent</span> <span class="kw">==</span> <span class="st">"patches"</span><span class="kw">&amp;</span> <span class="no">`[step]`</span> <span class="kw">&lt;</span> <span class="no">n</span>) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">pxcor</span>, <span class="no">pycor</span>, <span class="no">pcolor</span>, <span class="no">`[step]`</span>)

<span class="co">## Plot animation:</span>
<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">patches</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">pxcor</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">pycor</span>, <span class="kw">fill</span><span class="kw">=</span><span class="no">pcolor</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">turtles</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">xcor</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">ycor</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">who</span>), <span class="kw">size</span><span class="kw">=</span><span class="fl">2</span>) +
  <span class="fu">scale_fill_carto_c</span>(<span class="kw">palette</span> <span class="kw">=</span> <span class="st">"Prism"</span>) +
  <span class="fu"><a href="https://gganimate.com/reference/transition_time.html">transition_time</a></span>(<span class="no">`[step]`</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span>(<span class="kw">fill</span><span class="kw">=</span><span class="st">"none"</span>, <span class="kw">color</span><span class="kw">=</span><span class="st">"none"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span>()

<span class="kw pkg">gganimate</span><span class="kw ns">::</span><span class="fu"><a href="https://gganimate.com/reference/animate.html">animate</a></span>(<span class="no">p1</span>, <span class="kw">nframes</span> <span class="kw">=</span> <span class="no">n</span>, <span class="kw">width</span><span class="kw">=</span><span class="fl">800</span>, <span class="kw">height</span><span class="kw">=</span><span class="fl">800</span>, <span class="kw">duration</span><span class="kw">=</span><span class="fl">6</span>)</pre></body></html></div>
<center>
<img src="https://github.com/nldoc/nlrx_playground/raw/master/gif/diffusion.gif" align="center" width="100%">
</center>
</div>
<div id="fire-model" class="section level2">
<h2 class="hasAnchor">
<a href="#fire-model" class="anchor"></a>Fire model</h2>
<p>Similar to the diffusion example, the fire model displays patches and moving turtles. However, the model contains two turtle breeds which need to be displayed differently.</p>
<p>Thus, we also measure the turtle breed (metrics.turtles). Before plotting we split up the turtle data into two tibbles, one for each breed. This allows us to create two different geom_point layers with different aesthetics.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co">## Step1: Create a nl obejct:</span>
<span class="no">nl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/nl.html">nl</a></span>(<span class="kw">nlversion</span> <span class="kw">=</span> <span class="st">"6.0.4"</span>,
         <span class="kw">nlpath</span> <span class="kw">=</span> <span class="no">netlogopath</span>,
         <span class="kw">modelpath</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">netlogopath</span>, <span class="st">"app/models/Sample Models/Earth Science/Fire.nlogo"</span>),
         <span class="kw">jvmmem</span> <span class="kw">=</span> <span class="fl">1024</span>)

<span class="co">## Step2: Add Experiment</span>
<span class="no">nl</span>@<span class="kw">experiment</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/experiment.html">experiment</a></span>(<span class="kw">expname</span> <span class="kw">=</span> <span class="st">"fire"</span>,
                            <span class="kw">outpath</span> <span class="kw">=</span> <span class="no">outpath</span>,
                            <span class="kw">repetition</span> <span class="kw">=</span> <span class="fl">1</span>,
                            <span class="kw">tickmetrics</span> <span class="kw">=</span> <span class="st">"true"</span>,
                            <span class="kw">idsetup</span> <span class="kw">=</span> <span class="st">"setup"</span>,
                            <span class="kw">idgo</span> <span class="kw">=</span> <span class="st">"go"</span>,
                            <span class="kw">runtime</span> <span class="kw">=</span> <span class="fl">500</span>,
                            <span class="kw">evalticks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>,<span class="fl">500</span>),
                            <span class="kw">metrics</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"count patches"</span>),
                            <span class="kw">metrics.turtles</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"turtles"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"who"</span>, <span class="st">"pxcor"</span>, <span class="st">"pycor"</span>, <span class="st">"breed"</span>, <span class="st">"color"</span>)),
                            <span class="kw">metrics.patches</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"pxcor"</span>, <span class="st">"pycor"</span>, <span class="st">"pcolor"</span>),
                            <span class="kw">constants</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">'density'</span> <span class="kw">=</span> <span class="fl">62</span>)
)

<span class="co"># Evaluate if variables and constants are valid:</span>
<span class="fu"><a href="../../reference/eval_variables_constants.html">eval_variables_constants</a></span>(<span class="no">nl</span>)

<span class="co">## Step3: Add a Simulation Design</span>
<span class="no">nl</span>@<span class="kw">simdesign</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/simdesign_simple.html">simdesign_simple</a></span>(<span class="kw">nl</span> <span class="kw">=</span> <span class="no">nl</span>,
                                 <span class="kw">nseeds</span> <span class="kw">=</span> <span class="fl">1</span>)


<span class="co"># Step4: Run simulations:</span>
<span class="no">results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/run_nl_all.html">run_nl_all</a></span>(<span class="kw">nl</span> <span class="kw">=</span> <span class="no">nl</span>)

<span class="co">## Postprocessing:</span>
<span class="co">## Step1: Attach results to nl:</span>
<span class="fu"><a href="../../reference/setsim.html">setsim</a></span>(<span class="no">nl</span>, <span class="st">"simoutput"</span>) <span class="kw">&lt;-</span> <span class="no">results</span>

<span class="no">nl_spatial</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/unnest_simoutput.html">unnest_simoutput</a></span>(<span class="no">nl</span>)
<span class="no">n</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">nl_spatial</span>$<span class="no">`[step]`</span>)

<span class="no">embers</span> <span class="kw">&lt;-</span> <span class="no">nl_spatial</span> <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">breed</span> <span class="kw">==</span> <span class="st">"embers"</span> <span class="kw">&amp;</span> <span class="no">agent</span> <span class="kw">==</span> <span class="st">"turtles"</span> <span class="kw">&amp;</span> <span class="no">`[step]`</span> <span class="kw">&lt;</span> <span class="no">n</span>) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">pxcor</span>, <span class="no">pycor</span>, <span class="no">`[step]`</span>, <span class="no">color</span>, <span class="no">who</span>)
<span class="no">fires</span> <span class="kw">&lt;-</span> <span class="no">nl_spatial</span> <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">breed</span> <span class="kw">==</span> <span class="st">"fires"</span> <span class="kw">&amp;</span> <span class="no">agent</span> <span class="kw">==</span> <span class="st">"turtles"</span> <span class="kw">&amp;</span> <span class="no">`[step]`</span> <span class="kw">&lt;</span> <span class="no">n</span>) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">pxcor</span>, <span class="no">pycor</span>, <span class="no">`[step]`</span>, <span class="no">color</span>, <span class="no">who</span>)
<span class="no">patches</span> <span class="kw">&lt;-</span> <span class="no">nl_spatial</span> <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">agent</span> <span class="kw">==</span> <span class="st">"patches"</span> <span class="kw">&amp;</span> <span class="no">`[step]`</span> <span class="kw">&lt;</span> <span class="no">n</span>) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">pxcor</span>, <span class="no">pycor</span>, <span class="no">pcolor</span>, <span class="no">`[step]`</span>)

<span class="co"># make same space in the memory</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="no">nl</span>)
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="no">results</span>)
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span>(<span class="no">nl_spatial</span>)
<span class="fu"><a href="https://rdrr.io/r/base/gc.html">gc</a></span>()

<span class="co">#----------------------------------</span>
<span class="co">## Plot animation:</span>
<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">embers</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">patches</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">pxcor</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">pycor</span>, <span class="kw">fill</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">pcolor</span>))) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">embers</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">pxcor</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">pycor</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">color</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">who</span>), <span class="kw">size</span><span class="kw">=</span><span class="fl">2</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_color_gradientn</a></span>(<span class="kw">colors</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html">rev</a></span>(<span class="kw pkg">cartography</span><span class="kw ns">::</span><span class="fu">carto.pal</span>(<span class="st">"orange.pal"</span>, <span class="kw">n1</span> <span class="kw">=</span> <span class="fl">8</span>))) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">fires</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">pxcor</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">pycor</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">color</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">who</span>), <span class="kw">size</span><span class="kw">=</span><span class="fl">3</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html">scale_fill_manual</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"0"</span> <span class="kw">=</span> <span class="st">"gray24"</span>, <span class="st">"55"</span> <span class="kw">=</span> <span class="st">"#83B37D"</span>, <span class="st">"11.4"</span> <span class="kw">=</span> <span class="st">"#B59A89"</span>)) +
  <span class="fu"><a href="https://gganimate.com/reference/transition_time.html">transition_time</a></span>(<span class="no">`[step]`</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span>(<span class="kw">fill</span><span class="kw">=</span><span class="st">"none"</span>, <span class="kw">color</span><span class="kw">=</span><span class="st">"none"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span>()

<span class="no">g1</span> <span class="kw">&lt;-</span> <span class="kw pkg">gganimate</span><span class="kw ns">::</span><span class="fu"><a href="https://gganimate.com/reference/animate.html">animate</a></span>(<span class="no">p1</span>, <span class="kw">nframes</span> <span class="kw">=</span> <span class="no">n</span>, <span class="kw">width</span><span class="kw">=</span><span class="fl">800</span>, <span class="kw">height</span><span class="kw">=</span><span class="fl">800</span>, <span class="kw">duration</span> <span class="kw">=</span> <span class="fl">6</span>)</pre></body></html></div>
<center>
<img src="https://github.com/nldoc/nlrx_playground/raw/master/gif/fire.gif" align="center" width="100%">
</center>
</div>
<div id="ants-model" class="section level2">
<h2 class="hasAnchor">
<a href="#ants-model" class="anchor"></a>Ants model</h2>
<p>The Ants model is another typical example for displaying patches and moving turtles. Ants move across the lattice in order to gather food from food sources and returning food to their nest in the center. Ants carrying food leave a trail of chemicals on cells they move over. These chemicals also diffuse to neighboring cells over time. Displaying the patches output from the model is not straightforward because three different groups of patches exist: food sources, ants nest and all other patches which are coloured depending on the amount of chemicals that the patch contains.</p>
<p>In order to transfer the spatial information from NetLogo to R, we measure the who number, coordinates and breed for all turtles (metrics.turtles) and coordinates, patch color, amount of chemicals, presence of food and the food source number of all patches (metrics.patches).</p>
<p>After converting the spatial data to tibble format (<code><a href="../../reference/unnest_simoutput.html">unnest_simoutput()</a></code>), we split the patches information in three objects in order to display the three groups of patches:</p>
<ul>
<li>chem_dat: Contains chemical distribution of all patches. The amount of chemicals of each patch is plotted by using a geom_tile layer that acts as base layer of our plot.</li>
<li>food_dat: Contains patches coordinates of patches that contain food sources (food &gt; 0). The food sources are plotted by adding a square shaped geom_point layer on top of the chemicals distribution layer.</li>
<li>nest_dat: Contains patches coordinates of the nest patch. The nest is plotted by adding a large circle geom_point layer on top.</li>
</ul>
<p>The turtle data is plotted by adding another geom_text layer, using a Yen sign (￥) that displays the movement of the turtles. In order to render animated gifs with gganimate it is very important to set the group property of the layer correctly (group=who).</p>
<p>The plot need to be stored in an object before it can be rendered with the <code>gganimate</code> function. In some cases, it is important to set the number of frames explicitly to the number of steps of your simulation output. Otherwise, gganimate may interpolate between measured steps, which may lead to incorrect results.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co">## Step1: Create a nl obejct:</span>
<span class="no">nl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/nl.html">nl</a></span>(<span class="kw">nlversion</span> <span class="kw">=</span> <span class="st">"6.0.4"</span>,
         <span class="kw">nlpath</span> <span class="kw">=</span> <span class="no">netlogopath</span>,
         <span class="kw">modelpath</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">netlogopath</span>, <span class="st">"app/models/Sample Models/Biology/Ants.nlogo"</span>),
         <span class="kw">jvmmem</span> <span class="kw">=</span> <span class="fl">1024</span>)

<span class="co">## Step2: Add Experiment</span>
<span class="no">nl</span>@<span class="kw">experiment</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/experiment.html">experiment</a></span>(<span class="kw">expname</span> <span class="kw">=</span> <span class="st">"ants"</span>,
                            <span class="kw">outpath</span> <span class="kw">=</span> <span class="no">outpath</span>,
                            <span class="kw">repetition</span> <span class="kw">=</span> <span class="fl">1</span>,
                            <span class="kw">tickmetrics</span> <span class="kw">=</span> <span class="st">"true"</span>,
                            <span class="kw">idsetup</span> <span class="kw">=</span> <span class="st">"setup"</span>,
                            <span class="kw">idgo</span> <span class="kw">=</span> <span class="st">"go"</span>,
                            <span class="kw">runtime</span> <span class="kw">=</span> <span class="fl">1000</span>,
                            <span class="kw">evalticks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>,<span class="fl">1000</span>),
                            <span class="kw">metrics.turtles</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"turtles"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"who"</span>, <span class="st">"pxcor"</span>, <span class="st">"pycor"</span>, <span class="st">"breed"</span>)),
                            <span class="kw">metrics.patches</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"pxcor"</span>, <span class="st">"pycor"</span>, <span class="st">"pcolor"</span>, <span class="st">"chemical"</span>, <span class="st">"food"</span>, <span class="st">"food-source-number"</span>),
                            <span class="kw">constants</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"population"</span> <span class="kw">=</span> <span class="fl">125</span>,
                                             <span class="st">'diffusion-rate'</span> <span class="kw">=</span> <span class="fl">50</span>,
                                             <span class="st">'evaporation-rate'</span> <span class="kw">=</span> <span class="fl">10</span>))

<span class="co">## Step3: Add a Simulation Design</span>
<span class="no">nl</span>@<span class="kw">simdesign</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/simdesign_simple.html">simdesign_simple</a></span>(<span class="kw">nl</span> <span class="kw">=</span> <span class="no">nl</span>,
                                 <span class="kw">nseeds</span> <span class="kw">=</span> <span class="fl">1</span>)


<span class="co">## Step4: Run simulations:</span>
<span class="no">results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/run_nl_all.html">run_nl_all</a></span>(<span class="kw">nl</span> <span class="kw">=</span> <span class="no">nl</span>)

<span class="co">## Step5: Attach results to nl and reformat spatial data with get_nl_spatial()</span>
<span class="fu"><a href="../../reference/setsim.html">setsim</a></span>(<span class="no">nl</span>, <span class="st">"simoutput"</span>) <span class="kw">&lt;-</span> <span class="no">results</span>
<span class="no">nl_spatial</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/unnest_simoutput.html">unnest_simoutput</a></span>(<span class="no">nl</span>)

<span class="co">## Step6: Prepare data for plotting</span>
<span class="co"># Extract infromation on food sources and select maximum step as simulation length:</span>
<span class="no">food_dat</span> <span class="kw">&lt;-</span> <span class="no">nl_spatial</span> <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">food</span> <span class="kw">&gt;</span> <span class="fl">0</span>) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">pxcor</span>, <span class="no">pycor</span>, <span class="no">`[step]`</span>)
<span class="no">nmax</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">food_dat</span>$<span class="no">`[step]`</span>)
<span class="no">food_dat</span> <span class="kw">&lt;-</span> <span class="no">food_dat</span> <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">`[step]`</span> <span class="kw">%in%</span> <span class="fl">1</span>:<span class="no">nmax</span>)
<span class="co"># Extract information on chemicals and apply minimum treshhold for coloring:</span>
<span class="no">chem_dat</span> <span class="kw">&lt;-</span> <span class="no">nl_spatial</span> <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">`[step]`</span> <span class="kw">%in%</span> <span class="fl">1</span>:<span class="no">nmax</span>) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">pxcor</span>, <span class="no">pycor</span>, <span class="no">chemical</span>, <span class="no">`[step]`</span>)
<span class="no">chem_dat</span>$<span class="no">chemical</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span>(<span class="no">chem_dat</span>$<span class="no">chemical</span> <span class="kw">&lt;=</span> <span class="fl">0.2</span>, <span class="fl">NA</span>, <span class="no">chem_dat</span>$<span class="no">chemical</span>)
<span class="co"># Extract information on turtle positions:</span>
<span class="no">turt_dat</span> <span class="kw">&lt;-</span> <span class="no">nl_spatial</span> <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(!<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">who</span>)) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">`[step]`</span> <span class="kw">%in%</span> <span class="fl">1</span>:<span class="no">nmax</span>) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">pxcor</span>, <span class="no">pycor</span>, <span class="no">who</span>, <span class="no">`[step]`</span>)
<span class="co"># Create a new data frame to overlay the nest position (in this case the center of the world 0,0)</span>
<span class="no">nest_dat</span> <span class="kw">&lt;-</span> <span class="no">food_dat</span>
<span class="no">nest_dat</span>$<span class="no">pxcor</span> <span class="kw">&lt;-</span> <span class="fl">0</span>
<span class="no">nest_dat</span>$<span class="no">pycor</span> <span class="kw">&lt;-</span> <span class="fl">0</span>

<span class="co">## Step7: Plotting</span>
<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">food_dat</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_tile</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">chem_dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">pxcor</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">pycor</span>, <span class="kw">fill</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">chemical</span>))) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">food_dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">pxcor</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">pycor</span>), <span class="kw">color</span><span class="kw">=</span><span class="st">"black"</span>, <span class="kw">shape</span><span class="kw">=</span><span class="fl">15</span>, <span class="kw">size</span><span class="kw">=</span><span class="fl">4.5</span>, <span class="kw">alpha</span><span class="kw">=</span><span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">turt_dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">pxcor</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">pycor</span>, <span class="kw">group</span><span class="kw">=</span><span class="no">who</span>, <span class="kw">color</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span>(<span class="no">who</span>)), <span class="kw">size</span><span class="kw">=</span><span class="fl">5</span>, <span class="kw">alpha</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">label</span><span class="kw">=</span><span class="st">"&lt;U+FFE5&gt;"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">nest_dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">pxcor</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">pycor</span>), <span class="kw">color</span><span class="kw">=</span><span class="st">"brown"</span>, <span class="kw">fill</span><span class="kw">=</span><span class="st">"white"</span>, <span class="kw">size</span><span class="kw">=</span><span class="fl">30</span>, <span class="kw">stroke</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">shape</span><span class="kw">=</span><span class="fl">21</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_fill_viridis_c</a></span>(<span class="kw">direction</span><span class="kw">=</span>-<span class="fl">1</span>, <span class="kw">option</span><span class="kw">=</span><span class="st">"magma"</span>, <span class="kw">na.value</span> <span class="kw">=</span> <span class="st">"white"</span>) +
  <span class="fu"><a href="https://rdrr.io/pkg/ggthemes/man/scale_colour_gradient_tableau.html">scale_color_gradient_tableau</a></span>(<span class="kw">palette</span><span class="kw">=</span><span class="st">"Orange"</span>) +
  <span class="fu"><a href="https://gganimate.com/reference/transition_time.html">transition_time</a></span>(<span class="no">`[step]`</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span>(<span class="kw">fill</span><span class="kw">=</span><span class="st">"none"</span>, <span class="kw">color</span><span class="kw">=</span><span class="st">"none"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span>(<span class="kw">title</span> <span class="kw">=</span> <span class="st">'Step: {frame_time}'</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span>()

<span class="co">## Step8: Animate the plot and use 1 frame for each step of the model simulations</span>
<span class="kw pkg">gganimate</span><span class="kw ns">::</span><span class="fu"><a href="https://gganimate.com/reference/animate.html">animate</a></span>(<span class="no">p1</span>, <span class="kw">nframes</span> <span class="kw">=</span> <span class="no">nmax</span>, <span class="kw">width</span><span class="kw">=</span><span class="fl">800</span>, <span class="kw">height</span><span class="kw">=</span><span class="fl">800</span>, <span class="kw">fps</span><span class="kw">=</span><span class="fl">10</span>)</pre></body></html></div>
<center>
<img src="https://github.com/nldoc/nlrx_playground/raw/master/gif/ants.gif" align="center" width="100%">
</center>
</div>
<div id="waves-model" class="section level2">
<h2 class="hasAnchor">
<a href="#waves-model" class="anchor"></a>Waves model</h2>
<p>The waves model contains no patch information. Three types of turtle agents are present in the model: waves, edges and a driver. However, these agents are not defined by using breeds but by using turtles-own variables (driver?, edge?).</p>
<p>In addition to these two variables we measure the who number, turtle coordinates and turtle color. Again, before plotting we split the spatial data tibble from <code><a href="../../reference/unnest_simoutput.html">unnest_simoutput()</a></code> into three different tibbles, one for each agent group. These agent groups are then plotted by using geom_point layers with different aesthetics.</p>
<p>Instead of a simple simdesign with only one parameterization, this example uses a distinct simdesign with 4 different friction values. We can use the facet functionality of ggplot to visualize all four model runs at once.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co">## The models library filepath pointing to the waves model contains an ampersand which needs to be escaped on Windows but not on Linux.</span>
<span class="co">## Choose the filepath according to your OS:</span>
<span class="co">## Windows:</span>
<span class="no">modelpath</span> <span class="kw">&lt;-</span> <span class="st">"app/models/Sample Models/Chemistry ^&amp; Physics/Waves/Wave Machine.nlogo"</span>
<span class="co">## Linux:</span>
<span class="no">modelpath</span> <span class="kw">&lt;-</span> <span class="st">"app/models/Sample Models/Chemistry &amp; Physics/Waves/Wave Machine.nlogo"</span>

<span class="co">## Step1: Create a nl obejct:</span>
<span class="no">nl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/nl.html">nl</a></span>(<span class="kw">nlversion</span> <span class="kw">=</span> <span class="st">"6.0.4"</span>,
         <span class="kw">nlpath</span> <span class="kw">=</span> <span class="no">netlogopath</span>,
         <span class="kw">modelpath</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">netlogopath</span>, <span class="no">modelpath</span>),
         <span class="kw">jvmmem</span> <span class="kw">=</span> <span class="fl">1024</span>)

<span class="co">## Step2: Add Experiment</span>
<span class="no">nl</span>@<span class="kw">experiment</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/experiment.html">experiment</a></span>(<span class="kw">expname</span> <span class="kw">=</span> <span class="st">"waves"</span>,
                            <span class="kw">outpath</span> <span class="kw">=</span> <span class="no">outpath</span>,
                            <span class="kw">repetition</span> <span class="kw">=</span> <span class="fl">1</span>,
                            <span class="kw">tickmetrics</span> <span class="kw">=</span> <span class="st">"true"</span>,
                            <span class="kw">idsetup</span> <span class="kw">=</span> <span class="st">"setup"</span>,
                            <span class="kw">idgo</span> <span class="kw">=</span> <span class="st">"go"</span>,
                            <span class="kw">runtime</span> <span class="kw">=</span> <span class="fl">100</span>,
                            <span class="kw">evalticks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>,<span class="fl">100</span>),
                            <span class="kw">variables</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">'friction'</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">values</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">5</span>,<span class="fl">25</span>,<span class="fl">50</span>,<span class="fl">90</span>))),
                            <span class="kw">constants</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"stiffness"</span> <span class="kw">=</span> <span class="fl">20</span>),
                            <span class="kw">metrics.turtles</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"turtles"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"who"</span>, <span class="st">"xcor"</span>, <span class="st">"ycor"</span>, <span class="st">"driver?"</span>, <span class="st">"edge?"</span>, <span class="st">"color"</span>)))

<span class="co">## Step3: Add a Simulation Design</span>
<span class="no">nl</span>@<span class="kw">simdesign</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/simdesign_distinct.html">simdesign_distinct</a></span>(<span class="kw">nl</span> <span class="kw">=</span> <span class="no">nl</span>,
                                   <span class="kw">nseeds</span> <span class="kw">=</span> <span class="fl">1</span>)


<span class="co"># Step4: Run simulations:</span>
<span class="no">results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/run_nl_all.html">run_nl_all</a></span>(<span class="kw">nl</span> <span class="kw">=</span> <span class="no">nl</span>)

<span class="co">## Postprocessing:</span>
<span class="co">## Step1: Attach results to nl:</span>
<span class="fu"><a href="../../reference/setsim.html">setsim</a></span>(<span class="no">nl</span>, <span class="st">"simoutput"</span>) <span class="kw">&lt;-</span> <span class="no">results</span>


<span class="co"># Prepare data for plotting</span>
<span class="no">nl_spatial</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/unnest_simoutput.html">unnest_simoutput</a></span>(<span class="no">nl</span>)

<span class="no">nl_spatial</span>$<span class="no">friction</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span>(<span class="no">nl_spatial</span>$<span class="no">friction</span>)
<span class="fu"><a href="https://rdrr.io/r/base/levels.html">levels</a></span>(<span class="no">nl_spatial</span>$<span class="no">friction</span>) <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Friction = 5"</span>,
                                 <span class="st">"Friction = 25"</span>,
                                 <span class="st">"Friction = 50"</span>,
                                 <span class="st">"Friction = 90"</span>)

<span class="no">n</span> <span class="kw">&lt;-</span> <span class="no">nl</span>@<span class="kw">experiment</span>@<span class="kw">runtime</span>

<span class="no">waves</span>  <span class="kw">&lt;-</span> <span class="no">nl_spatial</span> <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">`driver?`</span> <span class="kw">==</span> <span class="st">"false"</span> <span class="kw">&amp;</span> <span class="no">`edge?`</span> <span class="kw">==</span> <span class="st">"false"</span> <span class="kw">&amp;</span> <span class="no">`[step]`</span> <span class="kw">&lt;</span> <span class="no">n</span>) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">xcor</span>, <span class="no">ycor</span>, <span class="no">`[step]`</span>, <span class="no">who</span>, <span class="no">color</span>, <span class="no">friction</span>)
<span class="no">egde</span>   <span class="kw">&lt;-</span> <span class="no">nl_spatial</span> <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">`driver?`</span> <span class="kw">==</span> <span class="st">"false"</span> <span class="kw">&amp;</span> <span class="no">`edge?`</span> <span class="kw">==</span> <span class="st">"true"</span> <span class="kw">&amp;</span> <span class="no">`[step]`</span> <span class="kw">&lt;</span> <span class="no">n</span>) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">xcor</span>, <span class="no">ycor</span>, <span class="no">`[step]`</span>, <span class="no">who</span>, <span class="no">friction</span>)
<span class="no">driver</span> <span class="kw">&lt;-</span> <span class="no">nl_spatial</span> <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">`driver?`</span> <span class="kw">==</span> <span class="st">"true"</span> <span class="kw">&amp;</span> <span class="no">`edge?`</span> <span class="kw">==</span> <span class="st">"false"</span> <span class="kw">&amp;</span> <span class="no">`[step]`</span> <span class="kw">&lt;</span> <span class="no">n</span>) <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">xcor</span>, <span class="no">ycor</span>, <span class="no">`[step]`</span>, <span class="no">who</span>, <span class="no">friction</span>)

<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">waves</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">waves</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">xcor</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">ycor</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">who</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="no">color</span>), <span class="kw">size</span><span class="kw">=</span><span class="fl">2</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">driver</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">xcor</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">ycor</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">who</span>), <span class="kw">size</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"grey"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">egde</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">xcor</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">ycor</span>, <span class="kw">group</span> <span class="kw">=</span> <span class="no">who</span>), <span class="kw">size</span><span class="kw">=</span><span class="fl">2</span>, <span class="kw">color</span> <span class="kw">=</span> <span class="st">"black"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span>(~<span class="no">friction</span>) +
  <span class="fu"><a href="https://gganimate.com/reference/transition_time.html">transition_time</a></span>(<span class="no">`[step]`</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span>(<span class="kw">color</span><span class="kw">=</span><span class="st">"none"</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span>()

<span class="kw pkg">gganimate</span><span class="kw ns">::</span><span class="fu"><a href="https://gganimate.com/reference/animate.html">animate</a></span>(<span class="no">p1</span>, <span class="kw">width</span><span class="kw">=</span><span class="fl">800</span>, <span class="kw">height</span><span class="kw">=</span><span class="fl">800</span>, <span class="kw">duration</span> <span class="kw">=</span> <span class="fl">6</span>)</pre></body></html></div>
<center>
<img src="https://github.com/nldoc/nlrx_playground/raw/master/gif/waves.gif" align="center" width="100%">
</center>
</div>
<div id="flocking-model" class="section level2">
<h2 class="hasAnchor">
<a href="#flocking-model" class="anchor"></a>Flocking Model</h2>
<p>The flocking model describes bird flocking formation using very simplified movement rules. For this model, headings (=viewing angles) of agents are crucial. The NetLogo heading system is measured in degree, ranging from 0 to 359. An agent with heading = 0 is pointing straight to the top border of the lattice. In order to transfer the NetLogo heading system to the ggplot and gganimate angle system, some conversions need to be done. The type of conversion depends on the geom that is used for plotting. We present two examples for heading conversion:</p>
<ol style="list-style-type: lower-alpha">
<li><p>geom_text can be used to plot arrows pointing into the heading of the agent. geom_text also uses degree angles, however an angle of 0 means text is pointing to the right edge of the plotting area. Furthermore, angles are counter-clockwise, whereas NetLogo headings are defined in clockwise direction. In our case we use a right-pointing ASCII-arrow as geom_text label. Thus, we need to shift all NetLogo headings by 90 degree to the right and invert the direction by multiplying all headings with -1.</p></li>
<li><p>geom_spoke can be used to plot arrows pointing into the heading of the agent. geom_spoke uses radians angles. Similar to geom_text angles, an angle of 0 is pointing to the right and angles are defined in counter-clockwise direction. Thus, we need to shift NetLogo headings by 90 degree to the right, inverse the direction by multiplying all headings with -1 and finally transform the degree angles to radians angles.</p></li>
</ol>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co">## Step1: Create a nl obejct:</span>
<span class="no">nl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/nl.html">nl</a></span>(<span class="kw">nlversion</span> <span class="kw">=</span> <span class="st">"6.0.4"</span>,
         <span class="kw">nlpath</span> <span class="kw">=</span> <span class="no">netlogopath</span>,
         <span class="kw">modelpath</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">netlogopath</span>, <span class="st">"app/models/Sample Models/Biology/Flocking.nlogo"</span>),
         <span class="kw">jvmmem</span> <span class="kw">=</span> <span class="fl">1024</span>)

<span class="co">## Step2: Add Experiment</span>
<span class="no">nl</span>@<span class="kw">experiment</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/experiment.html">experiment</a></span>(<span class="kw">expname</span> <span class="kw">=</span> <span class="st">"flocking"</span>,
                            <span class="kw">outpath</span> <span class="kw">=</span> <span class="no">outpath</span>,
                            <span class="kw">repetition</span> <span class="kw">=</span> <span class="fl">1</span>,
                            <span class="kw">tickmetrics</span> <span class="kw">=</span> <span class="st">"true"</span>,
                            <span class="kw">idsetup</span> <span class="kw">=</span> <span class="st">"setup"</span>,
                            <span class="kw">idgo</span> <span class="kw">=</span> <span class="st">"go"</span>,
                            <span class="kw">runtime</span> <span class="kw">=</span> <span class="fl">300</span>,
                            <span class="kw">evalticks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>,<span class="fl">300</span>),
                            <span class="kw">constants</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"population"</span> <span class="kw">=</span> <span class="fl">100</span>,
                                             <span class="st">"vision"</span> <span class="kw">=</span> <span class="fl">5</span>,
                                             <span class="st">"minimum-separation"</span> <span class="kw">=</span> <span class="fl">1</span>,
                                             <span class="st">"max-align-turn"</span> <span class="kw">=</span> <span class="fl">4</span>,
                                             <span class="st">"max-cohere-turn"</span> <span class="kw">=</span> <span class="fl">4</span>,
                                             <span class="st">"max-separate-turn"</span> <span class="kw">=</span> <span class="fl">4</span>),
                            <span class="kw">metrics.turtles</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"turtles"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"who"</span>, <span class="st">"xcor"</span>, <span class="st">"ycor"</span>, <span class="st">"heading"</span>, <span class="st">"color"</span>)))

<span class="co"># Evaluate if variables and constants are valid:</span>
<span class="fu"><a href="../../reference/eval_variables_constants.html">eval_variables_constants</a></span>(<span class="no">nl</span>)

<span class="co">## Step3: Add a Simulation Design</span>
<span class="no">nl</span>@<span class="kw">simdesign</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/simdesign_simple.html">simdesign_simple</a></span>(<span class="kw">nl</span> <span class="kw">=</span> <span class="no">nl</span>,
                                 <span class="kw">nseeds</span> <span class="kw">=</span> <span class="fl">1</span>)


<span class="co"># Step4: Run simulations:</span>
<span class="no">results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/run_nl_all.html">run_nl_all</a></span>(<span class="kw">nl</span> <span class="kw">=</span> <span class="no">nl</span>)

<span class="fu"><a href="../../reference/setsim.html">setsim</a></span>(<span class="no">nl</span>, <span class="st">"simoutput"</span>) <span class="kw">&lt;-</span> <span class="no">results</span>

<span class="no">nl_spatial</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/unnest_simoutput.html">unnest_simoutput</a></span>(<span class="no">nl</span>)

<span class="co">## Calculate angles for plotting:</span>
<span class="co"># (a) convert NetLogo degree headings (clockwise with 0 = top) to geom_text degree angle (counter-clockwise with 0 = right)</span>
<span class="co"># (b) convert geom_text degree angle to geom_spoke radians angle</span>
<span class="no">nl_spatial</span> <span class="kw">&lt;-</span> <span class="no">nl_spatial</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">`[step]`</span>, <span class="no">who</span>, <span class="no">xcor</span>, <span class="no">ycor</span>, <span class="no">heading</span>, <span class="no">color</span>) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">heading_text</span> <span class="kw">=</span> ((<span class="no">heading</span> * -<span class="fl">1</span>) + <span class="fl">90</span>)) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">heading_radians</span> <span class="kw">=</span> ((<span class="no">heading_text</span> * <span class="no">pi</span>) / <span class="fl">180</span>))

<span class="co"># Plot with geom_point and geom_spoke</span>
<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">nl_spatial</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">xcor</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">ycor</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span><span class="kw">=</span><span class="no">color</span>, <span class="kw">group</span><span class="kw">=</span><span class="no">who</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_spoke.html">geom_spoke</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span><span class="kw">=</span><span class="no">color</span>, <span class="kw">group</span><span class="kw">=</span><span class="no">who</span>, <span class="kw">angle</span><span class="kw">=</span><span class="no">heading_radians</span>), <span class="kw">arrow</span><span class="kw">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/reexports.html">arrow</a></span>(<span class="kw">length</span><span class="kw">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/reexports.html">unit</a></span>(<span class="fl">0.2</span>, <span class="st">"inches"</span>)), <span class="kw">radius</span><span class="kw">=</span><span class="fl">1</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span>(<span class="kw">color</span><span class="kw">=</span><span class="fl">FALSE</span>) +
  <span class="fu"><a href="https://gganimate.com/reference/transition_time.html">transition_time</a></span>(<span class="no">`[step]`</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span>()

<span class="kw pkg">gganimate</span><span class="kw ns">::</span><span class="fu"><a href="https://gganimate.com/reference/animate.html">animate</a></span>(<span class="no">p1</span>, <span class="kw">nframes</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">nl_spatial</span>$<span class="no">`[step]`</span>), <span class="kw">width</span><span class="kw">=</span><span class="fl">600</span>, <span class="kw">height</span><span class="kw">=</span><span class="fl">600</span>, <span class="kw">fps</span><span class="kw">=</span><span class="fl">20</span>)</pre></body></html></div>
<center>
<img src="https://github.com/nldoc/nlrx_playground/raw/master/gif/flocking_spoke.gif" align="center" width="75%">
</center>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co"># Plot with geom_text</span>
<span class="no">p2</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">nl_spatial</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span><span class="kw">=</span><span class="no">xcor</span>, <span class="kw">y</span><span class="kw">=</span><span class="no">ycor</span>)) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html">geom_text</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span><span class="kw">=</span><span class="no">color</span>, <span class="kw">group</span><span class="kw">=</span><span class="no">who</span>, <span class="kw">angle</span><span class="kw">=</span><span class="no">heading_text</span>), <span class="kw">label</span><span class="kw">=</span><span class="st">"&lt;U+2192&gt;"</span>, <span class="kw">size</span><span class="kw">=</span><span class="fl">5</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html">scale_color_viridis_c</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span>(<span class="kw">color</span><span class="kw">=</span><span class="fl">FALSE</span>) +
  <span class="fu"><a href="https://gganimate.com/reference/transition_time.html">transition_time</a></span>(<span class="no">`[step]`</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span>()

<span class="kw pkg">gganimate</span><span class="kw ns">::</span><span class="fu"><a href="https://gganimate.com/reference/animate.html">animate</a></span>(<span class="no">p2</span>, <span class="kw">nframes</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">nl_spatial</span>$<span class="no">`[step]`</span>), <span class="kw">width</span><span class="kw">=</span><span class="fl">600</span>, <span class="kw">height</span><span class="kw">=</span><span class="fl">600</span>, <span class="kw">fps</span><span class="kw">=</span><span class="fl">20</span>)</pre></body></html></div>
<center>
<img src="https://github.com/nldoc/nlrx_playground/raw/master/gif/flocking_text.gif" align="center" width="75%">
</center>
</div>
<div id="preferential-attachment" class="section level2">
<h2 class="hasAnchor">
<a href="#preferential-attachment" class="anchor"></a>Preferential Attachment</h2>
<p>The preferential attachment model from the NetLogo models library is a simple model of a growing network. New nodes spawn each time step and connect to the already existing network. The network is realized by connecting turtles with links. This example shows how link metrics can be measured, using the metrics.links slot of the experiment. Link positions in NetLogo are defined by start and end points (end1, end2) using who numbers of the turtles they connect. Thus, on each tick we measure end1 and end2 of each link (metrics.links) and the who number, xcor, ycor and color of each node turtle (metrics.turtles).</p>
<div id="visualize-network-using-ggplot" class="section level4">
<h4 class="hasAnchor">
<a href="#visualize-network-using-ggplot" class="anchor"></a>Visualize network using ggplot</h4>
<p>Again, after attaching the simulation results and postprocessing with <code><a href="../../reference/unnest_simoutput.html">unnest_simoutput()</a></code> we split the tibble into a turtles tibble and a links tibble by subsetting the group column.</p>
<p>Finally, we need to reference the who number start and end points of the links to the actual coordinates of the corresponding turtle on each step. This can be easily achieved with two left_join calls, one for end1 who numbers and one for end2 who numbers.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="co">## Step1: Create a nl obejct:</span>
<span class="no">nl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/nl.html">nl</a></span>(<span class="kw">nlversion</span> <span class="kw">=</span> <span class="st">"6.0.4"</span>,
         <span class="kw">nlpath</span> <span class="kw">=</span> <span class="no">netlogopath</span>,
         <span class="kw">modelpath</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span>(<span class="no">netlogopath</span>, <span class="st">"app/models/Sample Models/Networks/Preferential Attachment.nlogo"</span>),
         <span class="kw">jvmmem</span> <span class="kw">=</span> <span class="fl">1024</span>)

<span class="co">## Step2: Add Experiment</span>
<span class="no">nl</span>@<span class="kw">experiment</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/experiment.html">experiment</a></span>(<span class="kw">expname</span> <span class="kw">=</span> <span class="st">"networks"</span>,
                            <span class="kw">outpath</span> <span class="kw">=</span> <span class="no">outpath</span>,
                            <span class="kw">repetition</span> <span class="kw">=</span> <span class="fl">1</span>,
                            <span class="kw">tickmetrics</span> <span class="kw">=</span> <span class="st">"true"</span>,
                            <span class="kw">idsetup</span> <span class="kw">=</span> <span class="st">"setup"</span>,
                            <span class="kw">idgo</span> <span class="kw">=</span> <span class="st">"go"</span>,
                            <span class="kw">runtime</span> <span class="kw">=</span> <span class="fl">200</span>,
                            <span class="kw">evalticks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">1</span>,<span class="fl">200</span>),
                            <span class="kw">constants</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"layout?"</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
                            <span class="kw">metrics.turtles</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"turtles"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"who"</span>,
                                                                 <span class="st">"xcor"</span>,
                                                                 <span class="st">"ycor"</span>,
                                                                 <span class="st">"color"</span>)),
                            <span class="kw">metrics.links</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="st">"links"</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"[who] of end1"</span>,<span class="st">"[who] of end2"</span>)))

<span class="co">## Step3: Add simdesign</span>
<span class="no">nl</span>@<span class="kw">simdesign</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/simdesign_simple.html">simdesign_simple</a></span>(<span class="kw">nl</span><span class="kw">=</span><span class="no">nl</span>, <span class="kw">nseeds</span> <span class="kw">=</span> <span class="fl">1</span>)

<span class="co">## Run simulation:</span>
<span class="no">results</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/run_nl_one.html">run_nl_one</a></span>(<span class="kw">nl</span> <span class="kw">=</span> <span class="no">nl</span>,
                      <span class="kw">seed</span> <span class="kw">=</span> <span class="fu"><a href="../../reference/getsim.html">getsim</a></span>(<span class="no">nl</span>, <span class="st">"simseeds"</span>)[<span class="fl">1</span>],
                      <span class="kw">siminputrow</span> <span class="kw">=</span> <span class="fl">1</span>)

<span class="co">## Attach results to nl</span>
<span class="fu"><a href="../../reference/setsim.html">setsim</a></span>(<span class="no">nl</span>, <span class="st">"simoutput"</span>) <span class="kw">&lt;-</span> <span class="no">results</span>

<span class="co">## Postprocess spatial metrics with get_nl_spatial:</span>
<span class="no">nl_spatial</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/unnest_simoutput.html">unnest_simoutput</a></span>(<span class="no">nl</span>)

<span class="co">## Subset nl_spatial using the group column:</span>
<span class="no">nl_links</span> <span class="kw">&lt;-</span> <span class="no">nl_spatial</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">agent</span> <span class="kw">==</span> <span class="st">"links"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(-<span class="no">who</span>, -<span class="no">xcor</span>, -<span class="no">ycor</span>, -<span class="no">color</span>)

<span class="no">nl_turtles</span> <span class="kw">&lt;-</span> <span class="no">nl_spatial</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">agent</span> <span class="kw">==</span> <span class="st">"turtles"</span>) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span>(<span class="no">`[step]`</span>, <span class="no">who</span>, <span class="no">xcor</span>, <span class="no">ycor</span>, <span class="no">color</span>)

<span class="co">## Reference who numbers of link start (end1) and end (end2) points to actual coordinates:</span>
<span class="no">nl_links</span> <span class="kw">&lt;-</span> <span class="no">nl_links</span> <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">nl_turtles</span>, <span class="kw">by</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"[step]"</span><span class="kw">=</span><span class="st">"[step]"</span>,<span class="st">"end1"</span> <span class="kw">=</span> <span class="st">"who"</span>)) <span class="kw">%&gt;%</span>
  <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span>(<span class="no">nl_turtles</span>, <span class="kw">by</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"[step]"</span><span class="kw">=</span><span class="st">"[step]"</span>,<span class="st">"end2"</span> <span class="kw">=</span> <span class="st">"who"</span>))

<span class="co">## Plot:</span>
<span class="no">p1</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">nl_turtles</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">xcor</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">ycor</span>, <span class="kw">group</span><span class="kw">=</span><span class="no">who</span>), <span class="kw">color</span><span class="kw">=</span><span class="st">"red"</span>, <span class="kw">size</span><span class="kw">=</span><span class="fl">2</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span>(<span class="kw">data</span><span class="kw">=</span><span class="no">nl_links</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">x</span> <span class="kw">=</span> <span class="no">xcor.x</span>, <span class="kw">y</span> <span class="kw">=</span> <span class="no">ycor.x</span>, <span class="kw">xend</span> <span class="kw">=</span> <span class="no">xcor.y</span>, <span class="kw">yend</span> <span class="kw">=</span> <span class="no">ycor.y</span>), <span class="kw">size</span><span class="kw">=</span><span class="fl">0.5</span>) +
  <span class="fu"><a href="https://gganimate.com/reference/transition_time.html">transition_time</a></span>(<span class="no">`[step]`</span>) +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_equal</a></span>() +
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_void</a></span>()

<span class="kw pkg">gganimate</span><span class="kw ns">::</span><span class="fu"><a href="https://gganimate.com/reference/animate.html">animate</a></span>(<span class="no">p1</span>, <span class="kw">nframes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">nl_turtles</span>$<span class="no">`[step]`</span>), <span class="kw">width</span><span class="kw">=</span><span class="fl">400</span>, <span class="kw">height</span><span class="kw">=</span><span class="fl">400</span>, <span class="kw">fps</span><span class="kw">=</span><span class="fl">8</span>)</pre></body></html></div>
<center>
<img src="https://github.com/nldoc/nlrx_playground/raw/master/gif/networks.gif" align="center" width="75%">
</center>
</div>
<div id="visualize-network-using-igraph-package" class="section level4">
<h4 class="hasAnchor">
<a href="#visualize-network-using-igraph-package" class="anchor"></a>Visualize network using igraph package</h4>
<p>It is also possible to use the <a href="https://igraph.org/r/">igraph</a> package to visualize a NetLogo network. We use the <code><a href="../../reference/nl_to_graph.html">nl_to_graph()</a></code> function from the nlrx package to convert our spatial data into an igraph object. Here we want to display the network for only one simulation step, thus we filter our spatial data and select only the last simulation step. Again, we split the data into a turtles and a links tibble and rename the columns.</p>
<p>After conversion to an igraph object we can use the power of network analysis functions from the igraph package to do further analyses. In this example we perform a community cluster algorithm to color the nodes based on their community membership within the network.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co">## Load igraph package and convert spatial tibbles to igraph:</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">igraph</span>)
<span class="no">nw.all</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../../reference/nl_to_graph.html">nl_to_graph</a></span>(<span class="no">nl</span>)

<span class="co">## Select the last step and extract list element to get igraph object</span>
<span class="no">nw</span> <span class="kw">&lt;-</span> <span class="no">nw.all</span> <span class="kw">%&gt;%</span> <span class="kw pkg">dplyr</span><span class="kw ns">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(<span class="no">`[step]`</span> <span class="kw">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">`[step]`</span>))
<span class="no">nw</span> <span class="kw">&lt;-</span> <span class="no">nw</span>$<span class="no">spatial.links</span><span class="kw">[[</span><span class="fl">1</span>]]

<span class="co">## Perform community cluster algorithm and set community dependend colors:</span>
<span class="no">com</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/igraph/man/cluster_walktrap.html">walktrap.community</a></span>(<span class="no">nw</span>)
<span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html">V</a></span>(<span class="no">nw</span>)$<span class="no">community</span> <span class="kw">&lt;-</span> <span class="no">com</span>$<span class="no">membership</span>
<span class="no">rain</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">rainbow</a></span>(<span class="fl">14</span>, <span class="kw">alpha</span><span class="kw">=</span><span class="fl">.5</span>)
<span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html">V</a></span>(<span class="no">nw</span>)$<span class="no">color</span> <span class="kw">&lt;-</span> <span class="no">rain</span>[<span class="fu"><a href="https://rdrr.io/pkg/igraph/man/V.html">V</a></span>(<span class="no">nw</span>)$<span class="no">community</span>]

<span class="co">## Plot:</span>
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="no">nw</span>,
     <span class="kw">vertex.label</span><span class="kw">=</span><span class="fl">NA</span>,
     <span class="kw">vertex.size</span><span class="kw">=</span><span class="fl">4</span>,
     <span class="kw">edge.curved</span><span class="kw">=</span><span class="fl">0</span>,
     <span class="kw">layout</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/pkg/igraph/man/layout_with_fr.html">layout_with_fr</a></span>(<span class="no">nw</span>, <span class="kw">niter</span> <span class="kw">=</span> <span class="fl">3000</span>))</pre></body></html></div>
<center>
<img src="networks_igraph.png" align="center" width="75%">
</center>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jan Salecker, Marco Sciaini.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
