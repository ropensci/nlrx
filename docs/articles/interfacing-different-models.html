<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="nlrx">
<title>Interfacing a variety of different NetLogo models • nlrx | NetLogo from R</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Interfacing a variety of different NetLogo models">
<meta property="og:description" content="nlrx">
<meta property="og:image" content="https://docs.ropensci.org/nlrx/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">nlrx | NetLogo from R</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.4.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/getstarted.html">
    <span class="fa fa fa fa-magic"></span>
     
    Get Started
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/furthernotes.html">
    <span class="fa fa-book"></span>
     
    Advanced configuration
  </a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-more">More</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-more">
    <a class="dropdown-item" href="../articles/articles/spatial-output.html">
      <span class="fa fa-location-arrow"></span>
       
      Capturing spatial NetLogo output
    </a>
    <a class="dropdown-item" href="../articles/articles/manual-output.html">
      <span class="fa fa-location-arrow"></span>
       
      Capturing NetLogo output manually
    </a>
    <a class="dropdown-item" href="../articles/sensitivity.html">
      <span class="fa fa-gear"></span>
       
      Sensitivity Analysis with nlrx
    </a>
    <a class="dropdown-item" href="../articles/optimization.html">
      <span class="fa fa-gear"></span>
       
      Optimization with nlrx
    </a>
    <a class="dropdown-item" href="../articles/abc.html">
      <span class="fa fa-gear"></span>
       
      Approximate Bayesian Computation (ABC) with nlrx
    </a>
    <a class="dropdown-item" href="../articles/simdesign-examples.html">
      <span class="fa fa-gear"></span>
       
      Simdesign examples
    </a>
    <a class="dropdown-item" href="../articles/articles/interfacing-different-models.html">
      <span class="fa fa-image"></span>
       
      Interfacing a variety of different NetLogo models
    </a>
    <a class="dropdown-item" href="../articles/articles/nlrx_nldoc.html">
      <span class="fa fa-book"></span>
       
      NetLogo documentation with nlrx
    </a>
    <a class="dropdown-item" href="../articles/articles/nlrx_papers.html">
      <span class="fa fa-bookmark"></span>
       
      Publication record
    </a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/nlrx">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Interfacing a variety of different NetLogo models</h1>
                        <h4 data-toc-skip class="author">Marco
Sciaini</h4>
            
            <h4 data-toc-skip class="date">2023-05-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/nlrx/blob/HEAD/vignettes/articles/interfacing-different-models.Rmd" class="external-link"><code>vignettes/articles/interfacing-different-models.Rmd</code></a></small>
      <div class="d-none name"><code>interfacing-different-models.Rmd</code></div>
    </div>

    
    
<p>Here, we present examples on how to interface a variety of different
NetLogo models. NetLogo model interfaces are very diverse across models
and might contain spatial elements of different types (patches,
different groups of turtles, links). With our interfacing examples, we
try to cover a wide range of different models to show how
<strong>nlrx</strong> can be utilized for various applications.</p>
<p>Our examples show how spatial output from NetLogo models can be used
to create animated gif files, displaying patches and turtles properties
over time. We explicitly show how to setup, postprocess and plot spatial
output for very different model types. Although, the following examples
cover a wide range of output types, it is likely that different
experiment measurements or postprocessing needs to be done for specific
and complex models. If you have problems to interface a specific type of
model, feel free to send one of the authors of nlrx an email!</p>
<p>First, we need to load a bunch of packages, mainly for the subsetting
of the spatial data and the plotting:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Load packages</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/nlrx/">nlrx</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com" class="external-link">gganimate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/riatelab/cartography/" class="external-link">cartography</a></span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/Nowosad/rcartocolor" class="external-link">rcartocolor</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jrnold/ggthemes" class="external-link">ggthemes</a></span><span class="op">)</span> </span></code></pre></div>
<p>Second, we need to define the path variables pointing to the NetLogo
installation. Depending on the operation system, the NetLogo and output
paths need to be adjusted.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Windows default NetLogo installation path (adjust to your needs!):</span></span>
<span><span class="va">netlogopath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"C:/Program Files/NetLogo 6.0.4"</span><span class="op">)</span></span>
<span><span class="va">outpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"C:/out"</span><span class="op">)</span></span>
<span><span class="co"># Unix default NetLogo installation path (adjust to your needs!):</span></span>
<span><span class="va">netlogopath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"/home/NetLogo 6.0.4"</span><span class="op">)</span></span>
<span><span class="va">outpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"/home/out"</span><span class="op">)</span></span></code></pre></div>
<p>… and now are ready to interface some of the models of the NetLogo
model library.</p>
<div class="section level2">
<h2 id="diffusion-model">Diffusion model<a class="anchor" aria-label="anchor" href="#diffusion-model"></a>
</h2>
<p>The diffusion model is a simple example of how to plot moving turtles
and patches. Turtles move over the lattice and generate heat on cells
they move over. The accumulated heat also diffuses to neighboring
cells.</p>
<p>In order to transfer the spatial information from NetLogo to R, we
measure the who number and coordinates of all turtles (metrics.turtles)
and coordinates, patch color and amount of heat of all patches
(metrics.patches).</p>
<p>After converting the spatial data to tibble format
(<code><a href="../reference/unnest_simoutput.html">unnest_simoutput()</a></code>), we split the spatial data into a
turtles tibble and a patches tibble using the agent column of the
returned tibble from <code><a href="../reference/unnest_simoutput.html">unnest_simoutput()</a></code>. The plot consist
of a geom_tile layer, which displays the amount of heat in each cell and
a geom_point layer that displays the movement of the turtles. In order
to render animated gifs with gganimate it is very important to set the
group property of the turtles layer correctly (group=who).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Step1: Create a nl obejct:</span></span>
<span><span class="va">nl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nl.html">nl</a></span><span class="op">(</span>nlversion <span class="op">=</span> <span class="st">"6.0.4"</span>,</span>
<span>         nlpath <span class="op">=</span> <span class="va">netlogopath</span>,</span>
<span>         modelpath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">netlogopath</span>, <span class="st">"app/models/Sample Models/Art/Diffusion Graphics.nlogo"</span><span class="op">)</span>,</span>
<span>         jvmmem <span class="op">=</span> <span class="fl">1024</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Step2: Add Experiment</span></span>
<span><span class="va">nl</span><span class="op">@</span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/experiment.html">experiment</a></span><span class="op">(</span>expname <span class="op">=</span> <span class="st">"diffusion"</span>,</span>
<span>                            outpath <span class="op">=</span> <span class="va">outpath</span>,</span>
<span>                            repetition <span class="op">=</span> <span class="fl">1</span>,   </span>
<span>                            tickmetrics <span class="op">=</span> <span class="st">"true"</span>,</span>
<span>                            idsetup <span class="op">=</span> <span class="st">"setup"</span>,  </span>
<span>                            idgo <span class="op">=</span> <span class="st">"go"</span>,        </span>
<span>                            runtime <span class="op">=</span> <span class="fl">500</span>,</span>
<span>                            evalticks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">500</span><span class="op">)</span>,</span>
<span>                            constants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"num-turtles"</span> <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                             <span class="st">"diffusion-rate"</span> <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                             <span class="st">"turtle-heat"</span> <span class="op">=</span> <span class="fl">139</span>,</span>
<span>                                             <span class="st">"turtle-speed"</span> <span class="op">=</span> <span class="fl">1.0</span>,</span>
<span>                                             <span class="st">"wander?"</span> <span class="op">=</span> <span class="st">"TRUE"</span><span class="op">)</span>,</span>
<span>                            metrics.turtles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"turtles"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"who"</span>, <span class="st">"xcor"</span>, <span class="st">"ycor"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            metrics.patches <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pxcor"</span>, <span class="st">"pycor"</span>, <span class="st">"pcolor"</span>, <span class="st">"heat"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate if variables and constants are valid:</span></span>
<span><span class="fu"><a href="../reference/eval_variables_constants.html">eval_variables_constants</a></span><span class="op">(</span><span class="va">nl</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Step3: Add a Simulation Design</span></span>
<span><span class="va">nl</span><span class="op">@</span><span class="va">simdesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simdesign_simple.html">simdesign_simple</a></span><span class="op">(</span>nl <span class="op">=</span> <span class="va">nl</span>,</span>
<span>                                 nseeds <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Step4: Run simulations:</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_nl_all.html">run_nl_all</a></span><span class="op">(</span>nl <span class="op">=</span> <span class="va">nl</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Postprocessing:</span></span>
<span><span class="co">## Step1: Attach results to nl:</span></span>
<span><span class="fu"><a href="../reference/setsim.html">setsim</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"simoutput"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">results</span></span>
<span></span>
<span></span>
<span><span class="co"># Prepare data for plotting</span></span>
<span><span class="va">nl_spatial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unnest_simoutput.html">unnest_simoutput</a></span><span class="op">(</span><span class="va">nl</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="va">nl</span><span class="op">@</span><span class="va">experiment</span><span class="op">@</span><span class="va">runtime</span></span>
<span></span>
<span><span class="va">turtles</span> <span class="op">&lt;-</span> <span class="va">nl_spatial</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">agent</span> <span class="op">==</span> <span class="st">"turtles"</span> <span class="op">&amp;</span> <span class="va">`[step]`</span> <span class="op">&lt;</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">xcor</span>, <span class="va">ycor</span>, <span class="va">`[step]`</span>, <span class="va">who</span><span class="op">)</span></span>
<span><span class="va">patches</span> <span class="op">&lt;-</span> <span class="va">nl_spatial</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">agent</span> <span class="op">==</span> <span class="st">"patches"</span><span class="op">&amp;</span> <span class="va">`[step]`</span> <span class="op">&lt;</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">pxcor</span>, <span class="va">pycor</span>, <span class="va">pcolor</span>, <span class="va">`[step]`</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Plot animation:</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">patches</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">pxcor</span>, y <span class="op">=</span> <span class="va">pycor</span>, fill<span class="op">=</span><span class="va">pcolor</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">turtles</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xcor</span>, y <span class="op">=</span> <span class="va">ycor</span>, group <span class="op">=</span> <span class="va">who</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/rcartocolor/man/carto_scale.html" class="external-link">scale_fill_carto_c</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Prism"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://gganimate.com/reference/transition_time.html" class="external-link">transition_time</a></span><span class="op">(</span><span class="va">`[step]`</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"none"</span>, color<span class="op">=</span><span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">gganimate</span><span class="fu">::</span><span class="fu"><a href="https://gganimate.com/reference/animate.html" class="external-link">animate</a></span><span class="op">(</span><span class="va">p1</span>, nframes <span class="op">=</span> <span class="va">n</span>, width<span class="op">=</span><span class="fl">800</span>, height<span class="op">=</span><span class="fl">800</span>, duration<span class="op">=</span><span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://github.com/nldoc/nlrx_playground/raw/master/gif/diffusion.gif" align="center" width="100%">
</center>
</div>
<div class="section level2">
<h2 id="fire-model">Fire model<a class="anchor" aria-label="anchor" href="#fire-model"></a>
</h2>
<p>Similar to the diffusion example, the fire model displays patches and
moving turtles. However, the model contains two turtle breeds which need
to be displayed differently.</p>
<p>Thus, we also measure the turtle breed (metrics.turtles). Before
plotting we split up the turtle data into two tibbles, one for each
breed. This allows us to create two different geom_point layers with
different aesthetics.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Step1: Create a nl obejct:</span></span>
<span><span class="va">nl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nl.html">nl</a></span><span class="op">(</span>nlversion <span class="op">=</span> <span class="st">"6.0.4"</span>,</span>
<span>         nlpath <span class="op">=</span> <span class="va">netlogopath</span>,</span>
<span>         modelpath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">netlogopath</span>, <span class="st">"app/models/Sample Models/Earth Science/Fire.nlogo"</span><span class="op">)</span>,</span>
<span>         jvmmem <span class="op">=</span> <span class="fl">1024</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Step2: Add Experiment</span></span>
<span><span class="va">nl</span><span class="op">@</span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/experiment.html">experiment</a></span><span class="op">(</span>expname <span class="op">=</span> <span class="st">"fire"</span>,</span>
<span>                            outpath <span class="op">=</span> <span class="va">outpath</span>,</span>
<span>                            repetition <span class="op">=</span> <span class="fl">1</span>,    </span>
<span>                            tickmetrics <span class="op">=</span> <span class="st">"true"</span>,</span>
<span>                            idsetup <span class="op">=</span> <span class="st">"setup"</span>, </span>
<span>                            idgo <span class="op">=</span> <span class="st">"go"</span>,       </span>
<span>                            runtime <span class="op">=</span> <span class="fl">500</span>,</span>
<span>                            evalticks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">500</span><span class="op">)</span>,</span>
<span>                            metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"count patches"</span><span class="op">)</span>,</span>
<span>                            metrics.turtles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"turtles"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"who"</span>, <span class="st">"pxcor"</span>, <span class="st">"pycor"</span>, <span class="st">"breed"</span>, <span class="st">"color"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            metrics.patches <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pxcor"</span>, <span class="st">"pycor"</span>, <span class="st">"pcolor"</span><span class="op">)</span>,</span>
<span>                            constants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'density'</span> <span class="op">=</span> <span class="fl">62</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate if variables and constants are valid:</span></span>
<span><span class="fu"><a href="../reference/eval_variables_constants.html">eval_variables_constants</a></span><span class="op">(</span><span class="va">nl</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Step3: Add a Simulation Design</span></span>
<span><span class="va">nl</span><span class="op">@</span><span class="va">simdesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simdesign_simple.html">simdesign_simple</a></span><span class="op">(</span>nl <span class="op">=</span> <span class="va">nl</span>,</span>
<span>                                 nseeds <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Step4: Run simulations:</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_nl_all.html">run_nl_all</a></span><span class="op">(</span>nl <span class="op">=</span> <span class="va">nl</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Postprocessing:</span></span>
<span><span class="co">## Step1: Attach results to nl:</span></span>
<span><span class="fu"><a href="../reference/setsim.html">setsim</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"simoutput"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">results</span></span>
<span></span>
<span><span class="va">nl_spatial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unnest_simoutput.html">unnest_simoutput</a></span><span class="op">(</span><span class="va">nl</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">nl_spatial</span><span class="op">$</span><span class="va">`[step]`</span><span class="op">)</span></span>
<span>         </span>
<span><span class="va">embers</span> <span class="op">&lt;-</span> <span class="va">nl_spatial</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">breed</span> <span class="op">==</span> <span class="st">"embers"</span> <span class="op">&amp;</span> <span class="va">agent</span> <span class="op">==</span> <span class="st">"turtles"</span> <span class="op">&amp;</span> <span class="va">`[step]`</span> <span class="op">&lt;</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">pxcor</span>, <span class="va">pycor</span>, <span class="va">`[step]`</span>, <span class="va">color</span>, <span class="va">who</span><span class="op">)</span></span>
<span><span class="va">fires</span> <span class="op">&lt;-</span> <span class="va">nl_spatial</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">breed</span> <span class="op">==</span> <span class="st">"fires"</span> <span class="op">&amp;</span> <span class="va">agent</span> <span class="op">==</span> <span class="st">"turtles"</span> <span class="op">&amp;</span> <span class="va">`[step]`</span> <span class="op">&lt;</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">pxcor</span>, <span class="va">pycor</span>, <span class="va">`[step]`</span>, <span class="va">color</span>, <span class="va">who</span><span class="op">)</span></span>
<span><span class="va">patches</span> <span class="op">&lt;-</span> <span class="va">nl_spatial</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">agent</span> <span class="op">==</span> <span class="st">"patches"</span> <span class="op">&amp;</span> <span class="va">`[step]`</span> <span class="op">&lt;</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">pxcor</span>, <span class="va">pycor</span>, <span class="va">pcolor</span>, <span class="va">`[step]`</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make same space in the memory</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">nl</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">results</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">nl_spatial</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/gc.html" class="external-link">gc</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#----------------------------------</span></span>
<span><span class="co">## Plot animation:</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">embers</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">patches</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">pxcor</span>, y<span class="op">=</span><span class="va">pycor</span>, fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">pcolor</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">embers</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pxcor</span>, y <span class="op">=</span> <span class="va">pycor</span>, color <span class="op">=</span> <span class="va">color</span>, group <span class="op">=</span> <span class="va">who</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_color_gradientn</a></span><span class="op">(</span>colors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fu">cartography</span><span class="fu">::</span><span class="fu">carto.pal</span><span class="op">(</span><span class="st">"orange.pal"</span>, n1 <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">fires</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pxcor</span>, y <span class="op">=</span> <span class="va">pycor</span>, color <span class="op">=</span> <span class="va">color</span>, group <span class="op">=</span> <span class="va">who</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span> <span class="op">=</span> <span class="st">"gray24"</span>, <span class="st">"55"</span> <span class="op">=</span> <span class="st">"#83B37D"</span>, <span class="st">"11.4"</span> <span class="op">=</span> <span class="st">"#B59A89"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://gganimate.com/reference/transition_time.html" class="external-link">transition_time</a></span><span class="op">(</span><span class="va">`[step]`</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"none"</span>, color<span class="op">=</span><span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="fu">gganimate</span><span class="fu">::</span><span class="fu"><a href="https://gganimate.com/reference/animate.html" class="external-link">animate</a></span><span class="op">(</span><span class="va">p1</span>, nframes <span class="op">=</span> <span class="va">n</span>, width<span class="op">=</span><span class="fl">800</span>, height<span class="op">=</span><span class="fl">800</span>, duration <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://github.com/nldoc/nlrx_playground/raw/master/gif/fire.gif" align="center" width="100%">
</center>
</div>
<div class="section level2">
<h2 id="ants-model">Ants model<a class="anchor" aria-label="anchor" href="#ants-model"></a>
</h2>
<p>The Ants model is another typical example for displaying patches and
moving turtles. Ants move across the lattice in order to gather food
from food sources and returning food to their nest in the center. Ants
carrying food leave a trail of chemicals on cells they move over. These
chemicals also diffuse to neighboring cells over time. Displaying the
patches output from the model is not straightforward because three
different groups of patches exist: food sources, ants nest and all other
patches which are colored depending on the amount of chemicals that the
patch contains.</p>
<p>In order to transfer the spatial information from NetLogo to R, we
measure the who number, coordinates and breed for all turtles
(metrics.turtles) and coordinates, patch color, amount of chemicals,
presence of food and the food source number of all patches
(metrics.patches).</p>
<p>After converting the spatial data to tibble format
(<code><a href="../reference/unnest_simoutput.html">unnest_simoutput()</a></code>), we split the patches information in
three objects in order to display the three groups of patches:</p>
<ul>
<li>chem_dat: Contains chemical distribution of all patches. The amount
of chemicals of each patch is plotted by using a geom_tile layer that
acts as base layer of our plot.</li>
<li>food_dat: Contains patches coordinates of patches that contain food
sources (food &gt; 0). The food sources are plotted by adding a square
shaped geom_point layer on top of the chemicals distribution layer.</li>
<li>nest_dat: Contains patches coordinates of the nest patch. The nest
is plotted by adding a large circle geom_point layer on top.</li>
</ul>
<p>The turtle data is plotted by adding another geom_text layer, using a
Yen sign (￥) that displays the movement of the turtles. In order to
render animated gifs with gganimate it is very important to set the
group property of the layer correctly (group=who).</p>
<p>The plot need to be stored in an object before it can be rendered
with the <code>gganimate</code> function. In some cases, it is important
to set the number of frames explicitly to the number of steps of your
simulation output. Otherwise, gganimate may interpolate between measured
steps, which may lead to incorrect results.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Step1: Create a nl obejct:</span></span>
<span><span class="va">nl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nl.html">nl</a></span><span class="op">(</span>nlversion <span class="op">=</span> <span class="st">"6.0.4"</span>,</span>
<span>         nlpath <span class="op">=</span> <span class="va">netlogopath</span>,</span>
<span>         modelpath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">netlogopath</span>, <span class="st">"app/models/Sample Models/Biology/Ants.nlogo"</span><span class="op">)</span>,</span>
<span>         jvmmem <span class="op">=</span> <span class="fl">1024</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Step2: Add Experiment</span></span>
<span><span class="va">nl</span><span class="op">@</span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/experiment.html">experiment</a></span><span class="op">(</span>expname <span class="op">=</span> <span class="st">"ants"</span>,</span>
<span>                            outpath <span class="op">=</span> <span class="va">outpath</span>,</span>
<span>                            repetition <span class="op">=</span> <span class="fl">1</span>,      </span>
<span>                            tickmetrics <span class="op">=</span> <span class="st">"true"</span>,</span>
<span>                            idsetup <span class="op">=</span> <span class="st">"setup"</span>,   </span>
<span>                            idgo <span class="op">=</span> <span class="st">"go"</span>,         </span>
<span>                            runtime <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                            evalticks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1000</span><span class="op">)</span>,</span>
<span>                            metrics.turtles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"turtles"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"who"</span>, <span class="st">"pxcor"</span>, <span class="st">"pycor"</span>, <span class="st">"breed"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            metrics.patches <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pxcor"</span>, <span class="st">"pycor"</span>, <span class="st">"pcolor"</span>, <span class="st">"chemical"</span>, <span class="st">"food"</span>, <span class="st">"food-source-number"</span><span class="op">)</span>,</span>
<span>                            constants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"population"</span> <span class="op">=</span> <span class="fl">125</span>,</span>
<span>                                             <span class="st">'diffusion-rate'</span> <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                                             <span class="st">'evaporation-rate'</span> <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Step3: Add a Simulation Design</span></span>
<span><span class="va">nl</span><span class="op">@</span><span class="va">simdesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simdesign_simple.html">simdesign_simple</a></span><span class="op">(</span>nl <span class="op">=</span> <span class="va">nl</span>,</span>
<span>                                 nseeds <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## Step4: Run simulations:</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_nl_all.html">run_nl_all</a></span><span class="op">(</span>nl <span class="op">=</span> <span class="va">nl</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Step5: Attach results to nl and reformat spatial data with get_nl_spatial()</span></span>
<span><span class="fu"><a href="../reference/setsim.html">setsim</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"simoutput"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">results</span></span>
<span><span class="va">nl_spatial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unnest_simoutput.html">unnest_simoutput</a></span><span class="op">(</span><span class="va">nl</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Step6: Prepare data for plotting</span></span>
<span><span class="co"># Extract infromation on food sources and select maximum step as simulation length:</span></span>
<span><span class="va">food_dat</span> <span class="op">&lt;-</span> <span class="va">nl_spatial</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">food</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">pxcor</span>, <span class="va">pycor</span>, <span class="va">`[step]`</span><span class="op">)</span></span>
<span><span class="va">nmax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">food_dat</span><span class="op">$</span><span class="va">`[step]`</span><span class="op">)</span></span>
<span><span class="va">food_dat</span> <span class="op">&lt;-</span> <span class="va">food_dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">`[step]`</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="va">nmax</span><span class="op">)</span></span>
<span><span class="co"># Extract information on chemicals and apply minimum treshhold for coloring:</span></span>
<span><span class="va">chem_dat</span> <span class="op">&lt;-</span> <span class="va">nl_spatial</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">`[step]`</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="va">nmax</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">pxcor</span>, <span class="va">pycor</span>, <span class="va">chemical</span>, <span class="va">`[step]`</span><span class="op">)</span></span>
<span><span class="va">chem_dat</span><span class="op">$</span><span class="va">chemical</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">chem_dat</span><span class="op">$</span><span class="va">chemical</span> <span class="op">&lt;=</span> <span class="fl">0.2</span>, <span class="cn">NA</span>, <span class="va">chem_dat</span><span class="op">$</span><span class="va">chemical</span><span class="op">)</span></span>
<span><span class="co"># Extract information on turtle positions:</span></span>
<span><span class="va">turt_dat</span> <span class="op">&lt;-</span> <span class="va">nl_spatial</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">who</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">`[step]`</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="va">nmax</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">pxcor</span>, <span class="va">pycor</span>, <span class="va">who</span>, <span class="va">`[step]`</span><span class="op">)</span></span>
<span><span class="co"># Create a new data frame to overlay the nest position (in this case the center of the world 0,0)</span></span>
<span><span class="va">nest_dat</span> <span class="op">&lt;-</span> <span class="va">food_dat</span></span>
<span><span class="va">nest_dat</span><span class="op">$</span><span class="va">pxcor</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="va">nest_dat</span><span class="op">$</span><span class="va">pycor</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="co">## Step7: Plotting</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">food_dat</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">chem_dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">pxcor</span>, y<span class="op">=</span><span class="va">pycor</span>, fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">chemical</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">food_dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">pxcor</span>, y<span class="op">=</span><span class="va">pycor</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"black"</span>, shape<span class="op">=</span><span class="fl">15</span>, size<span class="op">=</span><span class="fl">4.5</span>, alpha<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">turt_dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">pxcor</span>, y<span class="op">=</span><span class="va">pycor</span>, group<span class="op">=</span><span class="va">who</span>, color<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">who</span><span class="op">)</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">5</span>, alpha<span class="op">=</span><span class="fl">1</span>, label<span class="op">=</span><span class="st">"￥"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">nest_dat</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">pxcor</span>, y<span class="op">=</span><span class="va">pycor</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"brown"</span>, fill<span class="op">=</span><span class="st">"white"</span>, size<span class="op">=</span><span class="fl">30</span>, stroke<span class="op">=</span><span class="fl">2</span>, shape<span class="op">=</span><span class="fl">21</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_fill_viridis_c</a></span><span class="op">(</span>direction<span class="op">=</span><span class="op">-</span><span class="fl">1</span>, option<span class="op">=</span><span class="st">"magma"</span>, na.value <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_color_gradient_tableau</span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Orange"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://gganimate.com/reference/transition_time.html" class="external-link">transition_time</a></span><span class="op">(</span><span class="va">`[step]`</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill<span class="op">=</span><span class="st">"none"</span>, color<span class="op">=</span><span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'Step: {frame_time}'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Step8: Animate the plot and use 1 frame for each step of the model simulations</span></span>
<span><span class="fu">gganimate</span><span class="fu">::</span><span class="fu"><a href="https://gganimate.com/reference/animate.html" class="external-link">animate</a></span><span class="op">(</span><span class="va">p1</span>, nframes <span class="op">=</span> <span class="va">nmax</span>, width<span class="op">=</span><span class="fl">800</span>, height<span class="op">=</span><span class="fl">800</span>, fps<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://github.com/nldoc/nlrx_playground/raw/master/gif/ants.gif" align="center" width="100%">
</center>
</div>
<div class="section level2">
<h2 id="waves-model">Waves model<a class="anchor" aria-label="anchor" href="#waves-model"></a>
</h2>
<p>The waves model contains no patch information. Three types of turtle
agents are present in the model: waves, edges and a driver. However,
these agents are not defined by using breeds but by using turtles-own
variables (driver?, edge?).</p>
<p>In addition to these two variables we measure the who number, turtle
coordinates and turtle color. Again, before plotting we split the
spatial data tibble from <code><a href="../reference/unnest_simoutput.html">unnest_simoutput()</a></code> into three
different tibbles, one for each agent group. These agent groups are then
plotted by using geom_point layers with different aesthetics.</p>
<p>Instead of a simple simdesign with only one parameterization, this
example uses a distinct simdesign with 4 different friction values. We
can use the facet functionality of ggplot to visualize all four model
runs at once.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## The models library filepath pointing to the waves model contains an ampersand which needs to be escaped on Windows but not on Linux.</span></span>
<span><span class="co">## Choose the filepath according to your OS:</span></span>
<span><span class="co">## Windows:</span></span>
<span><span class="va">modelpath</span> <span class="op">&lt;-</span> <span class="st">"app/models/Sample Models/Chemistry ^&amp; Physics/Waves/Wave Machine.nlogo"</span></span>
<span><span class="co">## Linux:</span></span>
<span><span class="va">modelpath</span> <span class="op">&lt;-</span> <span class="st">"app/models/Sample Models/Chemistry &amp; Physics/Waves/Wave Machine.nlogo"</span></span>
<span></span>
<span><span class="co">## Step1: Create a nl obejct:</span></span>
<span><span class="va">nl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nl.html">nl</a></span><span class="op">(</span>nlversion <span class="op">=</span> <span class="st">"6.0.4"</span>,</span>
<span>         nlpath <span class="op">=</span> <span class="va">netlogopath</span>,</span>
<span>         modelpath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">netlogopath</span>, <span class="va">modelpath</span><span class="op">)</span>,</span>
<span>         jvmmem <span class="op">=</span> <span class="fl">1024</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Step2: Add Experiment</span></span>
<span><span class="va">nl</span><span class="op">@</span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/experiment.html">experiment</a></span><span class="op">(</span>expname <span class="op">=</span> <span class="st">"waves"</span>,</span>
<span>                            outpath <span class="op">=</span> <span class="va">outpath</span>,</span>
<span>                            repetition <span class="op">=</span> <span class="fl">1</span>,      </span>
<span>                            tickmetrics <span class="op">=</span> <span class="st">"true"</span>,</span>
<span>                            idsetup <span class="op">=</span> <span class="st">"setup"</span>,  </span>
<span>                            idgo <span class="op">=</span> <span class="st">"go"</span>,</span>
<span>                            runtime <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                            evalticks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">100</span><span class="op">)</span>,</span>
<span>                            variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">'friction'</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">25</span>,<span class="fl">50</span>,<span class="fl">90</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            constants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"stiffness"</span> <span class="op">=</span> <span class="fl">20</span><span class="op">)</span>,</span>
<span>                            metrics.turtles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"turtles"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"who"</span>, <span class="st">"xcor"</span>, <span class="st">"ycor"</span>, <span class="st">"driver?"</span>, <span class="st">"edge?"</span>, <span class="st">"color"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Step3: Add a Simulation Design</span></span>
<span><span class="va">nl</span><span class="op">@</span><span class="va">simdesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simdesign_distinct.html">simdesign_distinct</a></span><span class="op">(</span>nl <span class="op">=</span> <span class="va">nl</span>,</span>
<span>                                   nseeds <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Step4: Run simulations:</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_nl_all.html">run_nl_all</a></span><span class="op">(</span>nl <span class="op">=</span> <span class="va">nl</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Postprocessing:</span></span>
<span><span class="co">## Step1: Attach results to nl:</span></span>
<span><span class="fu"><a href="../reference/setsim.html">setsim</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"simoutput"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">results</span></span>
<span></span>
<span></span>
<span><span class="co"># Prepare data for plotting</span></span>
<span><span class="va">nl_spatial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unnest_simoutput.html">unnest_simoutput</a></span><span class="op">(</span><span class="va">nl</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nl_spatial</span><span class="op">$</span><span class="va">friction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">nl_spatial</span><span class="op">$</span><span class="va">friction</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">nl_spatial</span><span class="op">$</span><span class="va">friction</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Friction = 5"</span>,</span>
<span>                                 <span class="st">"Friction = 25"</span>,</span>
<span>                                 <span class="st">"Friction = 50"</span>,</span>
<span>                                 <span class="st">"Friction = 90"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="va">nl</span><span class="op">@</span><span class="va">experiment</span><span class="op">@</span><span class="va">runtime</span></span>
<span></span>
<span><span class="va">waves</span>  <span class="op">&lt;-</span> <span class="va">nl_spatial</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">`driver?`</span> <span class="op">==</span> <span class="st">"false"</span> <span class="op">&amp;</span> <span class="va">`edge?`</span> <span class="op">==</span> <span class="st">"false"</span> <span class="op">&amp;</span> <span class="va">`[step]`</span> <span class="op">&lt;</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">xcor</span>, <span class="va">ycor</span>, <span class="va">`[step]`</span>, <span class="va">who</span>, <span class="va">color</span>, <span class="va">friction</span><span class="op">)</span></span>
<span><span class="va">egde</span>   <span class="op">&lt;-</span> <span class="va">nl_spatial</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">`driver?`</span> <span class="op">==</span> <span class="st">"false"</span> <span class="op">&amp;</span> <span class="va">`edge?`</span> <span class="op">==</span> <span class="st">"true"</span> <span class="op">&amp;</span> <span class="va">`[step]`</span> <span class="op">&lt;</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">xcor</span>, <span class="va">ycor</span>, <span class="va">`[step]`</span>, <span class="va">who</span>, <span class="va">friction</span><span class="op">)</span></span>
<span><span class="va">driver</span> <span class="op">&lt;-</span> <span class="va">nl_spatial</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">`driver?`</span> <span class="op">==</span> <span class="st">"true"</span> <span class="op">&amp;</span> <span class="va">`edge?`</span> <span class="op">==</span> <span class="st">"false"</span> <span class="op">&amp;</span> <span class="va">`[step]`</span> <span class="op">&lt;</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">xcor</span>, <span class="va">ycor</span>, <span class="va">`[step]`</span>, <span class="va">who</span>, <span class="va">friction</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">waves</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">waves</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xcor</span>, y <span class="op">=</span> <span class="va">ycor</span>, group <span class="op">=</span> <span class="va">who</span>, color <span class="op">=</span> <span class="va">color</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">driver</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xcor</span>, y <span class="op">=</span> <span class="va">ycor</span>, group <span class="op">=</span> <span class="va">who</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">2</span>, color <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">egde</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xcor</span>, y <span class="op">=</span> <span class="va">ycor</span>, group <span class="op">=</span> <span class="va">who</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">2</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">friction</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://gganimate.com/reference/transition_time.html" class="external-link">transition_time</a></span><span class="op">(</span><span class="va">`[step]`</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color<span class="op">=</span><span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">gganimate</span><span class="fu">::</span><span class="fu"><a href="https://gganimate.com/reference/animate.html" class="external-link">animate</a></span><span class="op">(</span><span class="va">p1</span>, width<span class="op">=</span><span class="fl">800</span>, height<span class="op">=</span><span class="fl">800</span>, duration <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://github.com/nldoc/nlrx_playground/raw/master/gif/waves.gif" align="center" width="100%">
</center>
</div>
<div class="section level2">
<h2 id="flocking-model">Flocking Model<a class="anchor" aria-label="anchor" href="#flocking-model"></a>
</h2>
<p>The flocking model describes bird flocking formation using very
simplified movement rules. For this model, headings (=viewing angles) of
agents are crucial. The NetLogo heading system is measured in degree,
ranging from 0 to 359. An agent with heading = 0 is pointing straight to
the top border of the lattice. In order to transfer the NetLogo heading
system to the ggplot and gganimate angle system, some conversions need
to be done. The type of conversion depends on the geom that is used for
plotting. We present two examples for heading conversion:</p>
<ol style="list-style-type: lower-alpha">
<li><p>geom_text can be used to plot arrows pointing into the heading of
the agent. geom_text also uses degree angles, however an angle of 0
means text is pointing to the right edge of the plotting area.
Furthermore, angles are counter-clockwise, whereas NetLogo headings are
defined in clockwise direction. In our case we use a right-pointing
ASCII-arrow as geom_text label. Thus, we need to shift all NetLogo
headings by 90 degree to the right and invert the direction by
multiplying all headings with -1.</p></li>
<li><p>geom_spoke can be used to plot arrows pointing into the heading
of the agent. geom_spoke uses radians angles. Similar to geom_text
angles, an angle of 0 is pointing to the right and angles are defined in
counter-clockwise direction. Thus, we need to shift NetLogo headings by
90 degree to the right, inverse the direction by multiplying all
headings with -1 and finally transform the degree angles to radians
angles.</p></li>
</ol>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Step1: Create a nl obejct:</span></span>
<span><span class="va">nl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nl.html">nl</a></span><span class="op">(</span>nlversion <span class="op">=</span> <span class="st">"6.0.4"</span>,</span>
<span>         nlpath <span class="op">=</span> <span class="va">netlogopath</span>,</span>
<span>         modelpath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">netlogopath</span>, <span class="st">"app/models/Sample Models/Biology/Flocking.nlogo"</span><span class="op">)</span>,</span>
<span>         jvmmem <span class="op">=</span> <span class="fl">1024</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Step2: Add Experiment</span></span>
<span><span class="va">nl</span><span class="op">@</span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/experiment.html">experiment</a></span><span class="op">(</span>expname <span class="op">=</span> <span class="st">"flocking"</span>,</span>
<span>                            outpath <span class="op">=</span> <span class="va">outpath</span>,</span>
<span>                            repetition <span class="op">=</span> <span class="fl">1</span>,      </span>
<span>                            tickmetrics <span class="op">=</span> <span class="st">"true"</span>,</span>
<span>                            idsetup <span class="op">=</span> <span class="st">"setup"</span>,   </span>
<span>                            idgo <span class="op">=</span> <span class="st">"go"</span>,         </span>
<span>                            runtime <span class="op">=</span> <span class="fl">300</span>,</span>
<span>                            evalticks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">300</span><span class="op">)</span>,</span>
<span>                            constants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"population"</span> <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                                             <span class="st">"vision"</span> <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                             <span class="st">"minimum-separation"</span> <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                                             <span class="st">"max-align-turn"</span> <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                                             <span class="st">"max-cohere-turn"</span> <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                                             <span class="st">"max-separate-turn"</span> <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>                            metrics.turtles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"turtles"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"who"</span>, <span class="st">"xcor"</span>, <span class="st">"ycor"</span>, <span class="st">"heading"</span>, <span class="st">"color"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Evaluate if variables and constants are valid:</span></span>
<span><span class="fu"><a href="../reference/eval_variables_constants.html">eval_variables_constants</a></span><span class="op">(</span><span class="va">nl</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Step3: Add a Simulation Design</span></span>
<span><span class="va">nl</span><span class="op">@</span><span class="va">simdesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simdesign_simple.html">simdesign_simple</a></span><span class="op">(</span>nl <span class="op">=</span> <span class="va">nl</span>,</span>
<span>                                 nseeds <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Step4: Run simulations:</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_nl_all.html">run_nl_all</a></span><span class="op">(</span>nl <span class="op">=</span> <span class="va">nl</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/setsim.html">setsim</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"simoutput"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">results</span></span>
<span></span>
<span><span class="va">nl_spatial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unnest_simoutput.html">unnest_simoutput</a></span><span class="op">(</span><span class="va">nl</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Calculate angles for plotting:</span></span>
<span><span class="co"># (a) convert NetLogo degree headings (clockwise with 0 = top) to geom_text degree angle (counter-clockwise with 0 = right)</span></span>
<span><span class="co"># (b) convert geom_text degree angle to geom_spoke radians angle</span></span>
<span><span class="va">nl_spatial</span> <span class="op">&lt;-</span> <span class="va">nl_spatial</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`[step]`</span>, <span class="va">who</span>, <span class="va">xcor</span>, <span class="va">ycor</span>, <span class="va">heading</span>, <span class="va">color</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>heading_text <span class="op">=</span> <span class="op">(</span><span class="op">(</span><span class="va">heading</span> <span class="op">*</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="fl">90</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>heading_radians <span class="op">=</span> <span class="op">(</span><span class="op">(</span><span class="va">heading_text</span> <span class="op">*</span> <span class="va">pi</span><span class="op">)</span> <span class="op">/</span> <span class="fl">180</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot with geom_point and geom_spoke</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">nl_spatial</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">xcor</span>, y<span class="op">=</span><span class="va">ycor</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">color</span>, group<span class="op">=</span><span class="va">who</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_spoke.html" class="external-link">geom_spoke</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">color</span>, group<span class="op">=</span><span class="va">who</span>, angle<span class="op">=</span><span class="va">heading_radians</span><span class="op">)</span>, arrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>length<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="st">"inches"</span><span class="op">)</span><span class="op">)</span>, radius<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://gganimate.com/reference/transition_time.html" class="external-link">transition_time</a></span><span class="op">(</span><span class="va">`[step]`</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">gganimate</span><span class="fu">::</span><span class="fu"><a href="https://gganimate.com/reference/animate.html" class="external-link">animate</a></span><span class="op">(</span><span class="va">p1</span>, nframes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">nl_spatial</span><span class="op">$</span><span class="va">`[step]`</span><span class="op">)</span>, width<span class="op">=</span><span class="fl">600</span>, height<span class="op">=</span><span class="fl">600</span>, fps<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://github.com/nldoc/nlrx_playground/raw/master/gif/flocking_spoke.gif" align="center" width="75%">
</center>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot with geom_text</span></span>
<span><span class="va">p2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">nl_spatial</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">xcor</span>, y<span class="op">=</span><span class="va">ycor</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_text</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color<span class="op">=</span><span class="va">color</span>, group<span class="op">=</span><span class="va">who</span>, angle<span class="op">=</span><span class="va">heading_text</span><span class="op">)</span>, label<span class="op">=</span><span class="st">"→"</span>, size<span class="op">=</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_color_viridis_c</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://gganimate.com/reference/transition_time.html" class="external-link">transition_time</a></span><span class="op">(</span><span class="va">`[step]`</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">gganimate</span><span class="fu">::</span><span class="fu"><a href="https://gganimate.com/reference/animate.html" class="external-link">animate</a></span><span class="op">(</span><span class="va">p2</span>, nframes<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">nl_spatial</span><span class="op">$</span><span class="va">`[step]`</span><span class="op">)</span>, width<span class="op">=</span><span class="fl">600</span>, height<span class="op">=</span><span class="fl">600</span>, fps<span class="op">=</span><span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://github.com/nldoc/nlrx_playground/raw/master/gif/flocking_text.gif" align="center" width="75%">
</center>
</div>
<div class="section level2">
<h2 id="preferential-attachment">Preferential Attachment<a class="anchor" aria-label="anchor" href="#preferential-attachment"></a>
</h2>
<p>The preferential attachment model from the NetLogo models library is
a simple model of a growing network. New nodes spawn each time step and
connect to the already existing network. The network is realized by
connecting turtles with links. This example shows how link metrics can
be measured, using the metrics.links slot of the experiment. Link
positions in NetLogo are defined by start and end points (end1, end2)
using who numbers of the turtles they connect. Thus, on each tick we
measure end1 and end2 of each link (metrics.links) and the who number,
xcor, ycor and color of each node turtle (metrics.turtles).</p>
<div class="section level4">
<h4 id="visualize-network-using-ggplot">Visualize network using ggplot<a class="anchor" aria-label="anchor" href="#visualize-network-using-ggplot"></a>
</h4>
<p>Again, after attaching the simulation results and postprocessing with
<code><a href="../reference/unnest_simoutput.html">unnest_simoutput()</a></code> we split the tibble into a turtles
tibble and a links tibble by subsetting the group column.</p>
<p>Finally, we need to reference the who number start and end points of
the links to the actual coordinates of the corresponding turtle on each
step. This can be easily achieved with two left_join calls, one for end1
who numbers and one for end2 who numbers.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Step1: Create a nl obejct:</span></span>
<span><span class="va">nl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nl.html">nl</a></span><span class="op">(</span>nlversion <span class="op">=</span> <span class="st">"6.0.4"</span>,</span>
<span>         nlpath <span class="op">=</span> <span class="va">netlogopath</span>,</span>
<span>         modelpath <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">netlogopath</span>, <span class="st">"app/models/Sample Models/Networks/Preferential Attachment.nlogo"</span><span class="op">)</span>,</span>
<span>         jvmmem <span class="op">=</span> <span class="fl">1024</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Step2: Add Experiment</span></span>
<span><span class="va">nl</span><span class="op">@</span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/experiment.html">experiment</a></span><span class="op">(</span>expname <span class="op">=</span> <span class="st">"networks"</span>,</span>
<span>                            outpath <span class="op">=</span> <span class="va">outpath</span>,</span>
<span>                            repetition <span class="op">=</span> <span class="fl">1</span>,    </span>
<span>                            tickmetrics <span class="op">=</span> <span class="st">"true"</span>,</span>
<span>                            idsetup <span class="op">=</span> <span class="st">"setup"</span>, </span>
<span>                            idgo <span class="op">=</span> <span class="st">"go"</span>,       </span>
<span>                            runtime <span class="op">=</span> <span class="fl">200</span>,</span>
<span>                            evalticks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">200</span><span class="op">)</span>,</span>
<span>                            constants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"layout?"</span> <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>                            metrics.turtles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"turtles"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"who"</span>, </span>
<span>                                                                 <span class="st">"xcor"</span>,                            </span>
<span>                                                                 <span class="st">"ycor"</span>,</span>
<span>                                                                 <span class="st">"color"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            metrics.links <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"links"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[who] of end1"</span>,<span class="st">"[who] of end2"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Step3: Add simdesign</span></span>
<span><span class="va">nl</span><span class="op">@</span><span class="va">simdesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simdesign_simple.html">simdesign_simple</a></span><span class="op">(</span>nl<span class="op">=</span><span class="va">nl</span>, nseeds <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Run simulation:</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_nl_one.html">run_nl_one</a></span><span class="op">(</span>nl <span class="op">=</span> <span class="va">nl</span>,</span>
<span>                      seed <span class="op">=</span> <span class="fu"><a href="../reference/getsim.html">getsim</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"simseeds"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>,</span>
<span>                      siminputrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Attach results to nl</span></span>
<span><span class="fu"><a href="../reference/setsim.html">setsim</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"simoutput"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">results</span></span>
<span></span>
<span><span class="co">## Postprocess spatial metrics with get_nl_spatial:</span></span>
<span><span class="va">nl_spatial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unnest_simoutput.html">unnest_simoutput</a></span><span class="op">(</span><span class="va">nl</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Subset nl_spatial using the group column:</span></span>
<span><span class="va">nl_links</span> <span class="op">&lt;-</span> <span class="va">nl_spatial</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">agent</span> <span class="op">==</span> <span class="st">"links"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">who</span>, <span class="op">-</span><span class="va">xcor</span>, <span class="op">-</span><span class="va">ycor</span>, <span class="op">-</span><span class="va">color</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nl_turtles</span> <span class="op">&lt;-</span> <span class="va">nl_spatial</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">agent</span> <span class="op">==</span> <span class="st">"turtles"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">`[step]`</span>, <span class="va">who</span>, <span class="va">xcor</span>, <span class="va">ycor</span>, <span class="va">color</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Reference who numbers of link start (end1) and end (end2) points to actual coordinates:</span></span>
<span><span class="va">nl_links</span> <span class="op">&lt;-</span> <span class="va">nl_links</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">nl_turtles</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[step]"</span><span class="op">=</span><span class="st">"[step]"</span>,<span class="st">"end1"</span> <span class="op">=</span> <span class="st">"who"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">nl_turtles</span>, by<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[step]"</span><span class="op">=</span><span class="st">"[step]"</span>,<span class="st">"end2"</span> <span class="op">=</span> <span class="st">"who"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Plot:</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">nl_turtles</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xcor</span>, y <span class="op">=</span> <span class="va">ycor</span>, group<span class="op">=</span><span class="va">who</span><span class="op">)</span>, color<span class="op">=</span><span class="st">"red"</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">nl_links</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xcor.x</span>, y <span class="op">=</span> <span class="va">ycor.x</span>, xend <span class="op">=</span> <span class="va">xcor.y</span>, yend <span class="op">=</span> <span class="va">ycor.y</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://gganimate.com/reference/transition_time.html" class="external-link">transition_time</a></span><span class="op">(</span><span class="va">`[step]`</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">gganimate</span><span class="fu">::</span><span class="fu"><a href="https://gganimate.com/reference/animate.html" class="external-link">animate</a></span><span class="op">(</span><span class="va">p1</span>, nframes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">nl_turtles</span><span class="op">$</span><span class="va">`[step]`</span><span class="op">)</span>, width<span class="op">=</span><span class="fl">400</span>, height<span class="op">=</span><span class="fl">400</span>, fps<span class="op">=</span><span class="fl">8</span><span class="op">)</span></span></code></pre></div>
<center>
<img src="https://github.com/nldoc/nlrx_playground/raw/master/gif/networks.gif" align="center" width="75%">
</center>
</div>
<div class="section level4">
<h4 id="visualize-network-using-igraph-package">Visualize network using igraph package<a class="anchor" aria-label="anchor" href="#visualize-network-using-igraph-package"></a>
</h4>
<p>It is also possible to use the <a href="https://igraph.org/r/" class="external-link">igraph</a> package to visualize a NetLogo
network. We use the <code><a href="../reference/nl_to_graph.html">nl_to_graph()</a></code> function from the nlrx
package to convert our spatial data into an igraph object. Here we want
to display the network for only one simulation step, thus we filter our
spatial data and select only the last simulation step. Again, we split
the data into a turtles and a links tibble and rename the columns.</p>
<p>After conversion to an igraph object we can use the power of network
analysis functions from the igraph package to do further analyses. In
this example we perform a community cluster algorithm to color the nodes
based on their community membership within the network.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Load igraph package and convert spatial tibbles to igraph:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/" class="external-link">igraph</a></span><span class="op">)</span></span>
<span><span class="va">nw.all</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nl_to_graph.html">nl_to_graph</a></span><span class="op">(</span><span class="va">nl</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Select the last step and extract list element to get igraph object</span></span>
<span><span class="va">nw</span> <span class="op">&lt;-</span> <span class="va">nw.all</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">`[step]`</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">`[step]`</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nw</span> <span class="op">&lt;-</span> <span class="va">nw</span><span class="op">$</span><span class="va">spatial.links</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Perform community cluster algorithm and set community dependend colors:</span></span>
<span><span class="va">com</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r.igraph.org/reference/cluster_walktrap.html" class="external-link">walktrap.community</a></span><span class="op">(</span><span class="va">nw</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">nw</span><span class="op">)</span><span class="op">$</span><span class="va">community</span> <span class="op">&lt;-</span> <span class="va">com</span><span class="op">$</span><span class="va">membership</span></span>
<span><span class="va">rain</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fl">14</span>, alpha<span class="op">=</span><span class="fl">.5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">nw</span><span class="op">)</span><span class="op">$</span><span class="va">color</span> <span class="op">&lt;-</span> <span class="va">rain</span><span class="op">[</span><span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">nw</span><span class="op">)</span><span class="op">$</span><span class="va">community</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Plot:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nw</span>,</span>
<span>     vertex.label<span class="op">=</span><span class="cn">NA</span>,</span>
<span>     vertex.size<span class="op">=</span><span class="fl">4</span>,</span>
<span>     edge.curved<span class="op">=</span><span class="fl">0</span>,</span>
<span>     layout<span class="op">=</span><span class="fu"><a href="https://r.igraph.org/reference/layout_with_fr.html" class="external-link">layout_with_fr</a></span><span class="op">(</span><span class="va">nw</span>, niter <span class="op">=</span> <span class="fl">3000</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<center>
<img src="networks_igraph.png" align="center" width="75%">
</center>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://twitter.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-twitter"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
