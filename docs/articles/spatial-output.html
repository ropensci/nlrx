<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="nlrx">
<title>Spatial Output • nlrx | NetLogo from R</title>
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="/apple-touch-icon.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Spatial Output">
<meta property="og:description" content="nlrx">
<meta property="og:image" content="https://docs.ropensci.org/nlrx/logo.png">
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Matomo --><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css">
<script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script><script src="https://ropensci.org/scripts/matomo.js"></script><noscript><p><img src="https://ropensci.matomo.cloud/matomo.php?idsite=1&amp;rec=1" style="border:0;" alt=""></p></noscript>
<!-- End Matomo Code -->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    <a href="https://ropensci.org" class="external-link"><img src="https://ropensci.org/img/icon_short_white.svg" id="hexlogo" alt="rOpenSci"></a>
    <a class="navbar-brand me-2" href="../index.html">nlrx | NetLogo from R</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.4.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/getstarted.html">
    <span class="fa fa fa fa-magic"></span>
     
    Get Started
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/furthernotes.html">
    <span class="fa fa-book"></span>
     
    Advanced configuration
  </a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-more">More</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-more">
    <a class="dropdown-item" href="../articles/articles/spatial-output.html">
      <span class="fa fa-location-arrow"></span>
       
      Capturing spatial NetLogo output
    </a>
    <a class="dropdown-item" href="../articles/articles/manual-output.html">
      <span class="fa fa-location-arrow"></span>
       
      Capturing NetLogo output manually
    </a>
    <a class="dropdown-item" href="../articles/sensitivity.html">
      <span class="fa fa-gear"></span>
       
      Sensitivity Analysis with nlrx
    </a>
    <a class="dropdown-item" href="../articles/optimization.html">
      <span class="fa fa-gear"></span>
       
      Optimization with nlrx
    </a>
    <a class="dropdown-item" href="../articles/abc.html">
      <span class="fa fa-gear"></span>
       
      Approximate Bayesian Computation (ABC) with nlrx
    </a>
    <a class="dropdown-item" href="../articles/simdesign-examples.html">
      <span class="fa fa-gear"></span>
       
      Simdesign examples
    </a>
    <a class="dropdown-item" href="../articles/articles/interfacing-different-models.html">
      <span class="fa fa-image"></span>
       
      Interfacing a variety of different NetLogo models
    </a>
    <a class="dropdown-item" href="../articles/articles/nlrx_nldoc.html">
      <span class="fa fa-book"></span>
       
      NetLogo documentation with nlrx
    </a>
    <a class="dropdown-item" href="../articles/articles/nlrx_papers.html">
      <span class="fa fa-bookmark"></span>
       
      Publication record
    </a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ropensci/nlrx">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Spatial Output</h1>
                        <h4 data-toc-skip class="author">Jan
Salecker</h4>
            
            <h4 data-toc-skip class="date">2023-05-17</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/nlrx/blob/HEAD/vignettes/articles/spatial-output.Rmd" class="external-link"><code>vignettes/articles/spatial-output.Rmd</code></a></small>
      <div class="d-none name"><code>spatial-output.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="gathering-spatial-output-from-netlogo-model-simulations">Gathering spatial output from NetLogo model simulations<a class="anchor" aria-label="anchor" href="#gathering-spatial-output-from-netlogo-model-simulations"></a>
</h2>
<p>nlrx is able to gather spatial output from your NetLogo simulations.
The experiment class object provides slots for measuring turtles,
patches and link variables:</p>
<ul>
<li>metrics.turtles - a list with named vectors of strings defining
valid turtles-own variables that are taken as output measurements
(e.g. <code>list("turtles" = c("who", "pxcor", "pycor", "color")</code>)</li>
<li>metrics.patches - vector of valid patches-own variables that are
used to collect patches data
(e.g. <code>c("pxcor", "pycor", "pcolor")</code>)</li>
<li>metrics.links - a list with named vectors of strings defining valid
links-own variables that are taken as output measurements
(e.g. <code>list("links" = c("[who] of end1", "[who] of end2"))</code>)</li>
</ul>
<p>Basically, you can enter any variable of your model that is listed in
turtles-own, patches-own or links-own, however if you add variables that
contain strings, these strings must not contain any whitespaces or the
output data will not be parsed correctly.</p>
<p>If your model has agent variables that only exist for one specific
breed (breed-own), measuring those variables for all turtles would
result in a runtime error. Thus, different vectors of metrics can be
provided for each specific breed
(e.g. <code>metrics.turtles = list("breed_A" = c("who", "pxcor", "pycor", "var_of_breed_A"), "breed_B" = c("who", "pxcor", "pycor", "var_of_breed_B"))</code>).
This also works for links breeds.</p>
<p>If an experiment contains any agent metrics, the results of these
metrics will be nested inside the output results tibble. In order to
utilize these data, they need to be postprocessed. nlrx provides two
types of postprocessing functions:</p>
<ul>
<li>
<code><a href="../reference/unnest_simoutput.html">unnest_simoutput()</a></code> - This function may be used to
unnest the data within the output results tibble. It reports a long
tibble containing all parameters, variables and agent metrics. This
format is easily subsettable and is suited to produce plots using the
ggplot package, or create animations with gganimate.</li>
<li>
<code><a href="../reference/nl_to_graph.html">nl_to_graph()</a></code>, <code><a href="../reference/nl_to_raster.html">nl_to_raster()</a></code>,
<code><a href="../reference/nl_to_points.html">nl_to_points()</a></code> - These functions create spatial objects
from the nested data within the output results tibble. Please note, that
these functions have requirements on measured spatial variables:
<ul>
<li>
<code><a href="../reference/nl_to_graph.html">nl_to_graph()</a></code> - Reports igraph objects and needs at
least turtle who numbers and who numbers of link ends
(<code>metrics.turtles = list("turtles" = c("who")), metrics.links = list("links" = c("[who] of end1", "[who] of end2"))</code>).
Additional turtle and link variables will be stored as properties of the
igraph nodes and vertices.</li>
<li>
<code><a href="../reference/nl_to_raster.html">nl_to_raster()</a></code> - Reports raster objects and needs patch
coordinates and at least one patch variable
(<code>metrics.patches = c("pxcor", "pycor", "pcolor")</code>). If
several patch variables are provided, a raster stack is created with
rasters for each patch variable.</li>
<li>
<code><a href="../reference/nl_to_points.html">nl_to_points()</a></code> - Reports spatial point objects and
needs at least turtle coordinates, either pxcor/pycor or xcor/ycor
(<code>metrics.turtles = list("turtles" = c("xcor", "ycor", "who", "color"))</code>).
Additional turtle variables will be stored as properties of the spatial
points.</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="application-example-1-wolf-sheep-predation">Application Example 1: Wolf Sheep Predation<a class="anchor" aria-label="anchor" href="#application-example-1-wolf-sheep-predation"></a>
</h2>
<p>We use the Wolf Sheep Model from the NetLogo models library to
capture metrics of patches and turtles. We measure coordinates, who
numbers and the breed of turtles, and coordinates of patches and the
corresponding pcolor on each tick. We define our experiment accordingly
and run the simulations:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/nlrx/">nlrx</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com" class="external-link">gganimate</a></span><span class="op">)</span> <span class="co"># devtools::install_github('thomasp85/gganimate') - if you have troubles installing gganimate, you most likely also need to install gifski as system dependency</span></span>
<span></span>
<span><span class="co"># Windows default NetLogo installation path (adjust to your needs!):</span></span>
<span><span class="va">netlogopath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"C:/Program Files/NetLogo 6.0.3"</span><span class="op">)</span></span>
<span><span class="va">modelpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">netlogopath</span>, <span class="st">"app/models/Sample Models/Biology/Wolf Sheep Predation.nlogo"</span><span class="op">)</span></span>
<span><span class="va">outpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"C:/out"</span><span class="op">)</span></span>
<span><span class="co"># Unix default NetLogo installation path (adjust to your needs!):</span></span>
<span><span class="va">netlogopath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"/home/NetLogo 6.0.3"</span><span class="op">)</span></span>
<span><span class="va">modelpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">netlogopath</span>, <span class="st">"app/models/Sample Models/Biology/Wolf Sheep Predation.nlogo"</span><span class="op">)</span></span>
<span><span class="va">outpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"/home/out"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define nl object</span></span>
<span><span class="va">nl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nl.html">nl</a></span><span class="op">(</span>nlversion <span class="op">=</span> <span class="st">"6.0.3"</span>,</span>
<span>         nlpath <span class="op">=</span> <span class="va">netlogopath</span>,</span>
<span>         modelpath <span class="op">=</span> <span class="va">modelpath</span>,</span>
<span>         jvmmem <span class="op">=</span> <span class="fl">1024</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define experiment</span></span>
<span><span class="va">nl</span><span class="op">@</span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/experiment.html">experiment</a></span><span class="op">(</span>expname <span class="op">=</span> <span class="st">"nlrx_spatial"</span>,</span>
<span>                            outpath <span class="op">=</span> <span class="va">outpath</span>,</span>
<span>                            repetition <span class="op">=</span> <span class="fl">1</span>,      </span>
<span>                            tickmetrics <span class="op">=</span> <span class="st">"true"</span>,</span>
<span>                            idsetup <span class="op">=</span> <span class="st">"setup"</span>,   </span>
<span>                            idgo <span class="op">=</span> <span class="st">"go"</span>,         </span>
<span>                            runtime <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                            metrics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"count sheep"</span>,<span class="st">"count wolves"</span><span class="op">)</span>,</span>
<span>                            metrics.turtles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"turtles"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"who"</span>, <span class="st">"pxcor"</span>, <span class="st">"pycor"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            metrics.patches <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"pxcor"</span>, <span class="st">"pycor"</span>, <span class="st">"pcolor"</span><span class="op">)</span>,</span>
<span>                            constants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"model-version"</span> <span class="op">=</span> <span class="st">"\"sheep-wolves-grass\""</span>,</span>
<span>                                             <span class="st">'initial-number-sheep'</span> <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                                             <span class="st">'initial-number-wolves'</span> <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                                             <span class="st">"grass-regrowth-time"</span> <span class="op">=</span> <span class="fl">30</span>,</span>
<span>                                             <span class="st">"sheep-gain-from-food"</span> <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                                             <span class="st">"wolf-gain-from-food"</span> <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                             <span class="st">"sheep-reproduce"</span> <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                                             <span class="st">"wolf-reproduce"</span> <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                             <span class="st">"show-energy?"</span> <span class="op">=</span> <span class="st">"false"</span><span class="op">)</span></span>
<span>                            <span class="op">)</span></span>
<span></span>
<span><span class="co"># Attach simdesign simple using only constants</span></span>
<span><span class="va">nl</span><span class="op">@</span><span class="va">simdesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simdesign_simple.html">simdesign_simple</a></span><span class="op">(</span>nl<span class="op">=</span><span class="va">nl</span>,</span>
<span>                                 nseeds<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run simulations and store output in results</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_nl_all.html">run_nl_all</a></span><span class="op">(</span>nl <span class="op">=</span> <span class="va">nl</span><span class="op">)</span></span></code></pre></div>
<p>This experiment will run for 100 ticks (runtime) and collects all
metrics, metrics.turtles and metrics.patches on each tick (evalticks).
Thus, executing <code><a href="../reference/run_nl_all.html">run_nl_all()</a></code> will report a tibble
containing all metrics, metrics.turtles and metrics.patches. However,
because the spatial metrics contain more than one value, these datasets
are stored as lists inside the output tibble. These lists already
contain all measured agent metrics and can for example be used to
analyze distributions of these variables for specific agent groups.</p>
<div class="section level4">
<h4 id="postprocessing-example-1-unnest_simoutput">Postprocessing example 1: <code>unnest_simoutput()</code><a class="anchor" aria-label="anchor" href="#postprocessing-example-1-unnest_simoutput"></a>
</h4>
<p>We use the <code><a href="../reference/unnest_simoutput.html">unnest_simoutput()</a></code> function to create a large
tibble format which we can use for plotting. In order to use this
function, the simulation output need to be attached to the nl object
first (otherwise a warning will appear). The simdesign class within the
nl object provides a slot for attaching output results (simoutput). An
output results tibble can be attached to this slot by using the
simdesign setter function <code>setsim(nl, "simoutput")</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Attach results to nl object:</span></span>
<span><span class="fu"><a href="../reference/setsim.html">setsim</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"simoutput"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">results</span></span>
<span></span>
<span><span class="co"># Report spatial data:</span></span>
<span><span class="va">results_unnest</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/unnest_simoutput.html">unnest_simoutput</a></span><span class="op">(</span><span class="va">nl</span><span class="op">)</span></span></code></pre></div>
<p>The spatial tibble output from <code><a href="../reference/unnest_simoutput.html">unnest_simoutput()</a></code> can
for example be used to plot maps for different ticks of the model
simulation. Here is an example to create a facet plot using spatial
simulation data of every 10th simulation tick:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Split tibble into turtles and patches tibbles and select each 10th step:</span></span>
<span><span class="va">results_unnest_turtles</span> <span class="op">&lt;-</span> <span class="va">results_unnest</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">agent</span><span class="op">==</span><span class="st">"turtles"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">`[step]`</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">80</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">results_unnest_patches</span> <span class="op">&lt;-</span> <span class="va">results_unnest</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">agent</span><span class="op">==</span><span class="st">"patches"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">`[step]`</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">80</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create facet plot:</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">`[step]`</span>, ncol<span class="op">=</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">results_unnest_patches</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">pxcor</span>, y<span class="op">=</span><span class="va">pycor</span>, fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">pcolor</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">results_unnest_turtles</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pxcor</span>, y <span class="op">=</span> <span class="va">pycor</span>, color <span class="op">=</span> <span class="va">breed</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"35"</span>, <span class="st">"55"</span><span class="op">)</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"35"</span> <span class="op">=</span> <span class="st">"#D9AF6B"</span>, <span class="st">"55"</span> <span class="op">=</span> <span class="st">"#68855C"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sheep"</span>, <span class="st">"wolves"</span><span class="op">)</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sheep"</span> <span class="op">=</span> <span class="st">"beige"</span>, <span class="st">"wolves"</span> <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"LandCover"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Output maps of each 10th simulation tick"</span><span class="op">)</span></span></code></pre></div>
<p><img src="wolfsheep_world.png" align="center" width="100%"></p>
<p>Using the gganimate package(<a href="https://github.com/thomasp85/gganimate" class="external-link uri">https://github.com/thomasp85/gganimate</a>), it is even
possible to generate animated plots from this spatial data tibble. Here
is an example for a plot that has been generated by running the above
experiment and postprocessing the data with
<code><a href="../reference/unnest_simoutput.html">unnest_simoutput()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Split tibble into turtles and patches tibbles:</span></span>
<span><span class="va">results_unnest_turtles</span> <span class="op">&lt;-</span> <span class="va">results_unnest</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">agent</span> <span class="op">==</span> <span class="st">"turtles"</span><span class="op">)</span></span>
<span><span class="va">results_unnest_patches</span> <span class="op">&lt;-</span> <span class="va">results_unnest</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">agent</span> <span class="op">==</span> <span class="st">"patches"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create an animated plot, using the step column as animation variable</span></span>
<span><span class="va">p1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">results_unnest_patches</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">pxcor</span>, y<span class="op">=</span><span class="va">pycor</span>, fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">pcolor</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">results_unnest_turtles</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">pxcor</span>, y <span class="op">=</span> <span class="va">pycor</span>, group<span class="op">=</span><span class="va">who</span>, color <span class="op">=</span> <span class="va">breed</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"35"</span>, <span class="st">"55"</span><span class="op">)</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"35"</span> <span class="op">=</span> <span class="st">"#D9AF6B"</span>, <span class="st">"55"</span> <span class="op">=</span> <span class="st">"#68855C"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sheep"</span>, <span class="st">"wolves"</span><span class="op">)</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sheep"</span> <span class="op">=</span> <span class="st">"beige"</span>, <span class="st">"wolves"</span> <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>title<span class="op">=</span><span class="st">"LandCover"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://gganimate.com/reference/transition_time.html" class="external-link">transition_time</a></span><span class="op">(</span><span class="va">`[step]`</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'Step: {frame_time}'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Animate the plot and use 1 frame for each step of the model simulations</span></span>
<span><span class="fu">gganimate</span><span class="fu">::</span><span class="fu"><a href="https://gganimate.com/reference/animate.html" class="external-link">animate</a></span><span class="op">(</span><span class="va">p1</span>, nframes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">results_unnest_patches</span><span class="op">$</span><span class="va">`[step]`</span><span class="op">)</span><span class="op">)</span>, width<span class="op">=</span><span class="fl">400</span>, height<span class="op">=</span><span class="fl">400</span>, fps<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://gganimate.com/reference/anim_save.html" class="external-link">anim_save</a></span><span class="op">(</span><span class="st">"wolfsheep_world.gif"</span><span class="op">)</span></span></code></pre></div>
<center>
<img src="wolfsheep_world.gif" align="center" width="50%">
</center>
</div>
<div class="section level4">
<h4 id="postprocessing-example-2-nl_to_raster-and-nl_to_points">Postprocessing example 2: <code>nl_to_raster()</code> and
<code>nl_to_points()</code><a class="anchor" aria-label="anchor" href="#postprocessing-example-2-nl_to_raster-and-nl_to_points"></a>
</h4>
<p>A second option to postprocess spatial data is to convert patches
data to raster objects and turtles data to spatial point objects. This
can be handy if further spatial analyses are carried out, such as
calculating landscape metrics (e.g. with R-package <a href="https://github.com/r-spatialecology/landscapemetrics" class="external-link">landscapemetrics</a>).
In this example, we use the nl object with attached simulation output of
the previous example to generate raster and spatial point objects.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Create raster and point objects from patches and turtles data:</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="va">nlraster</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nl_to_raster.html">nl_to_raster</a></span><span class="op">(</span><span class="va">nl</span><span class="op">)</span></span>
<span><span class="va">nlpoints</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nl_to_points.html">nl_to_points</a></span><span class="op">(</span><span class="va">nl</span>, coords <span class="op">=</span> <span class="st">"px"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Plot raster and turtles of tick n:</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nlraster</span><span class="op">$</span><span class="va">spatial.raster</span><span class="op">[[</span><span class="va">n</span><span class="op">]</span><span class="op">]</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"35"</span> <span class="op">=</span> <span class="st">"#D9AF6B"</span>, <span class="st">"55"</span> <span class="op">=</span> <span class="st">"#68855C"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nlpoints</span><span class="op">$</span><span class="va">spatial.turtles</span><span class="op">[[</span><span class="va">n</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="st">"breed"</span><span class="op">]</span>, add<span class="op">=</span><span class="cn">TRUE</span>, pch<span class="op">=</span><span class="fl">16</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"sheep"</span> <span class="op">=</span> <span class="st">"beige"</span>, <span class="st">"wolves"</span> <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="application-example-2-giant-component">Application example 2: Giant component<a class="anchor" aria-label="anchor" href="#application-example-2-giant-component"></a>
</h2>
<p>We use the Giant Component model from the NetLogo models library to
capture metrics of turtles and links. The <code><a href="../reference/nl_to_graph.html">nl_to_graph()</a></code>
function generates igraph objects from measured turtles and links data.
It produces an igraph object for each row of the simoutput results
tibble. Thus, it reports one igraph network for each combination of
random-seed, siminputrow and step.</p>
<p>In order to generate igraph objects some metrics are mandatory: The
metrics.turtles slot of the experiment must contain “who” numbers (see
example experiment). Additional turtle metrics will be stored as
properties of the igraph vertices. The metrics.links slot of the
experiment must contain “who” numbers of link end1 and end2 (see example
experiment). Additional link metrics will be stored as properties of the
igraph edges.</p>
<p>For our application example, we are mainly interested in the final
network structure. We want to measure who numbers and color of turtles,
and who numbers of end1 and end2 of links on the final tick. We define
our experiment accordingly and run the simulations:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/nlrx/">nlrx</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.igraph.org/" class="external-link">igraph</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Windows default NetLogo installation path (adjust to your needs!):</span></span>
<span><span class="va">netlogopath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"C:/Program Files/NetLogo 6.0.4"</span><span class="op">)</span></span>
<span><span class="va">modelpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">netlogopath</span>, <span class="st">"app/models/Sample Models/Networks/Giant Component.nlogo"</span><span class="op">)</span></span>
<span><span class="va">outpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"C:/out"</span><span class="op">)</span></span>
<span><span class="co"># Unix default NetLogo installation path (adjust to your needs!):</span></span>
<span><span class="va">netlogopath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"/home/NetLogo 6.0.4"</span><span class="op">)</span></span>
<span><span class="va">modelpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">netlogopath</span>, <span class="st">"app/models/Sample Models/Networks/Giant Component.nlogo"</span><span class="op">)</span></span>
<span><span class="va">outpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"/home/out"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nl.html">nl</a></span><span class="op">(</span>nlversion <span class="op">=</span> <span class="st">"6.0.4"</span>,</span>
<span>         nlpath <span class="op">=</span> <span class="va">netlogopath</span>,</span>
<span>         modelpath <span class="op">=</span> <span class="va">modelpath</span>,</span>
<span>         jvmmem <span class="op">=</span> <span class="fl">1024</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nl</span><span class="op">@</span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/experiment.html">experiment</a></span><span class="op">(</span>expname<span class="op">=</span><span class="st">"networks"</span>,</span>
<span>                            outpath<span class="op">=</span><span class="va">outpath</span>,</span>
<span>                            repetition<span class="op">=</span><span class="fl">1</span>,</span>
<span>                            tickmetrics<span class="op">=</span><span class="st">"false"</span>,</span>
<span>                            idsetup<span class="op">=</span><span class="st">"setup"</span>,</span>
<span>                            idgo<span class="op">=</span><span class="st">"go"</span>,</span>
<span>                            runtime<span class="op">=</span><span class="fl">50</span>,</span>
<span>                            metrics.turtles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"turtles"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"who"</span>, <span class="st">"color"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            metrics.links <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"links"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"[who] of end1"</span>, <span class="st">"[who] of end2"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                            constants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"num-nodes"</span> <span class="op">=</span> <span class="fl">80</span>,</span>
<span>                                             <span class="st">"layout?"</span> <span class="op">=</span> <span class="st">"true"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">nl</span><span class="op">@</span><span class="va">simdesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simdesign_simple.html">simdesign_simple</a></span><span class="op">(</span><span class="va">nl</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_nl_all.html">run_nl_all</a></span><span class="op">(</span><span class="va">nl</span><span class="op">)</span></span></code></pre></div>
<p>In order to execute the <code><a href="../reference/nl_to_graph.html">nl_to_graph()</a></code> function, the
output results need to be attached to the nl object. Afterwards we can
create the igraph object with <code><a href="../reference/nl_to_graph.html">nl_to_graph()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Attach results to nl object:</span></span>
<span><span class="fu"><a href="../reference/setsim.html">setsim</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"simoutput"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">results</span></span>
<span><span class="co"># Create igraph:</span></span>
<span><span class="va">nl.graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nl_to_graph.html">nl_to_graph</a></span><span class="op">(</span><span class="va">nl</span><span class="op">)</span></span></code></pre></div>
<p>The igraph objects are attached to the output results tibble in the
newly generated column “spatial.links”. In our case, we only have one
row of results and thus only one igraph object. We can now extract this
object and do some plotting, using the igraph plotting function:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Extract graph of tick 1:</span></span>
<span><span class="va">nl.graph.i</span> <span class="op">&lt;-</span> <span class="va">nl.graph</span><span class="op">$</span><span class="va">spatial.links</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">## Set vertex colors by measured color variable:</span></span>
<span><span class="va">vcols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"7"</span> <span class="op">=</span> <span class="st">"grey"</span>, <span class="st">"15"</span> <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">nl.graph.i</span><span class="op">)</span><span class="op">$</span><span class="va">color</span> <span class="op">&lt;-</span> <span class="va">vcols</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://r.igraph.org/reference/V.html" class="external-link">V</a></span><span class="op">(</span><span class="va">nl.graph.i</span><span class="op">)</span><span class="op">$</span><span class="va">color</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="co">## Set edge colors by measured link breed:</span></span>
<span><span class="va">ecols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"links"</span> <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/E.html" class="external-link">E</a></span><span class="op">(</span><span class="va">nl.graph.i</span><span class="op">)</span><span class="op">$</span><span class="va">color</span> <span class="op">&lt;-</span> <span class="va">ecols</span><span class="op">[</span><span class="fu"><a href="https://r.igraph.org/reference/E.html" class="external-link">E</a></span><span class="op">(</span><span class="va">nl.graph.i</span><span class="op">)</span><span class="op">$</span><span class="va">breed</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Plot:</span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/plot.igraph.html" class="external-link">plot.igraph</a></span><span class="op">(</span><span class="va">nl.graph.i</span>, vertex.size<span class="op">=</span><span class="fl">8</span>, vertex.label<span class="op">=</span><span class="cn">NA</span>, edge.arrow.size<span class="op">=</span><span class="fl">0.2</span><span class="op">)</span></span></code></pre></div>
<p>We can also calculate network metrics using the igraph package:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Extract graph of tick 1:</span></span>
<span><span class="va">nl.graph.i</span> <span class="op">&lt;-</span> <span class="va">nl.graph</span><span class="op">$</span><span class="va">spatial.links</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Vertex and edge betweenness centrality</span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/betweenness.html" class="external-link">betweenness</a></span><span class="op">(</span><span class="va">nl.graph.i</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Clusters</span></span>
<span><span class="fu"><a href="https://r.igraph.org/reference/components.html" class="external-link">clusters</a></span><span class="op">(</span><span class="va">nl.graph.i</span><span class="op">)</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><!-- begin footer --><div class="footer">
    <div class="container">
        <div class="row start top-4 bottom-8">
            <div class="col-2"> <img id="footerlogo" src="https://ropensci.org/img/icon_short_white.svg">
</div>
            <div class="col-10">
                <div class="row">
                    <div class="col-md-4 col-xs-6">
                        <a href="https://github.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-github"></div></a>
                        <a href="https://github.com/ropenscilabs" target="_blank" class="external-link"><div class="icon fa fa-flask"></div></a>
                        <a href="https://twitter.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-twitter"></div></a>
                        <a href="https://vimeo.com/ropensci" target="_blank" class="external-link"><div class="icon fab fa-vimeo"></div></a>
                    </div>
                </div>
                <div class="row top-4">
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">About</h5>
                            <li><a href="https://ropensci.org/about" class="external-link">About rOpenSci</a></li>
                            <li><a href="https://ropensci.org/software-review" class="external-link">Software Review</a></li>
                            <li><a href="https://ropensci.org/about#team" class="external-link">Our Team</a></li>
                            <li><a href="https://ropensci.org/careers" class="external-link">Jobs</a></li>
                            <li><a href="https://ropensci.org/donate" class="external-link">Donate</a></li>
                            <li><a href="https://ropensci.org/contact" class="external-link">Contact Us</a></li>
                        </ul>
</div>
                    <div class="col-md-3 col-sm-4">
                        <ul>
<h5 class="bottom-2">Community</h5>
                            <li><a href="https://ropensci.org/community/" class="external-link">Our Community</a></li>
                            <li><a href="https://ropensci.org/commcalls/" class="external-link">Community calls</a></li>
                            <li><a href="https://ropensci.org/events/" class="external-link">Events</a></li>
                            <li><a href="https://discuss.ropensci.org/" class="external-link">Join the Discussion</a></li>
                            <li><a href="https://ropensci.org/code-of-conduct" class="external-link">Code of conduct</a></li>
                        </ul>
</div>
                    <div class="col-md-2 col-sm-4">
                        <ul>
<h5 class="bottom-2">Resources</h5>
                            <li><a href="https://ropensci.org/packages/" class="external-link">Packages</a></li>
                            <li><a href="https://ropensci.org/usecases/" class="external-link">Use Cases</a></li>
                            <li><a href="https://ropensci.org/talks-papers/" class="external-link">Talks &amp; Publications</a></li>
                            <li><a href="https://docs.ropensci.org/" class="external-link">Documentation</a></li>
                            <li><a href="https://ropensci.org/news/" class="external-link">Newsletter</a></li>
                            <li><a href="https://ropensci.org/how-to-cite-ropensci/" class="external-link">Cite rOpenSci</a></li>
                        </ul>
</div>
                    <div class="col-md-4 col-xs-12">
                        <h5 class="bottom-2"></h5>

                        <p>rOpenSci is a fiscally sponsored project of <a href="http://numfocus.org" class="external-link">NumFOCUS</a>.</p>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- / end footer -->


    </footer>
</div>

  

  

  </body>
</html>
