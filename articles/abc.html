<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Approximate Bayesian Computation (ABC) • nlrx | NetLogo from R</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Approximate Bayesian Computation (ABC)">
<meta property="og:description" content="nlrx">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">nlrx | NetLogo from R</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/getstarted.html">
    <span class="fa fa-magic"></span>
     
    Get Started
  </a>
</li>
<li>
  <a href="../articles/furthernotes.html">
    <span class="fa fa-book"></span>
     
    Advanced configuration
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-graduation-cap"></span>
     
    More
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/articles/spatial-output.html">
        <span class="fa fa-book"></span>
         
        Capturing spatial NetLogo output
      </a>
    </li>
    <li>
      <a href="../articles/articles/manual-output.html">
        <span class="fa fa-book"></span>
         
        Capturing NetLogo output manually
      </a>
    </li>
    <li>
      <a href="../articles/sensitivity.html">
        <span class="fa fa-wrench"></span>
         
        Sensitivity Analysis with nlrx
      </a>
    </li>
    <li>
      <a href="../articles/optimization.html">
        <span class="fa fa-wrench"></span>
         
        Optimization with nlrx
      </a>
    </li>
    <li>
      <a href="../articles/abc.html">
        <span class="fa fa-wrench"></span>
         
        Approximate Bayesian Computation (ABC) with nlrx
      </a>
    </li>
    <li>
      <a href="../articles/simdesign-examples.html">
        <span class="fa fa-wrench"></span>
         
        Simdesign examples
      </a>
    </li>
    <li>
      <a href="../articles/articles/interfacing-different-models.html">
        <span class="fa fa-wrench"></span>
         
        Interfacing a variety of different NetLogo models
      </a>
    </li>
    <li>
      <a href="../articles/articles/nlrx_nldoc.html">
        <span class="fa fa-wrench"></span>
         
        NetLogo documentation with nlrx
      </a>
    </li>
    <li>
      <a href="../articles/articles/nlrx_papers.html">
        <span class="fa fa-bookmark"></span>
         
        Publication record
      </a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../news/index.html">
    <span class="fa fa-newspaper"></span>
     
    news
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-cogs"></span>
     
    functions
  </a>
</li>
<li>
  <a href="https://github.com/ropensci/nlrx">
    <span class="fab fa-github fa-lg"></span>
     
    github
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="abc_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Approximate Bayesian Computation (ABC)</h1>
                        <h4 class="author">Jan Salecker</h4>
            
            <h4 class="date">2021-09-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ropensci/nlrx/blob/master/vignettes/abc.Rmd"><code>vignettes/abc.Rmd</code></a></small>
      <div class="hidden name"><code>abc.Rmd</code></div>

    </div>

    
    
<div id="approximate-bayesian-computation-abc-with-nlrx" class="section level1">
<h1 class="hasAnchor">
<a href="#approximate-bayesian-computation-abc-with-nlrx" class="anchor"></a>Approximate bayesian computation (ABC) with nlrx</h1>
<p>Approximate bayesian computation (ABC) algorithms have been increasingly used for calibration of agent-based simulation models. The nlrx package provides different algorithms from the <a href="https://cran.r-project.org/package=EasyABC">EasyABC package</a>. These algorithms can be used by attaching the corresponding simdesigns (<code><a href="../reference/simdesign_ABCmcmc_Marjoram.html">simdesign_ABCmcmc_Marjoram()</a></code>, <code><a href="../reference/simdesign_ABCmcmc_Marjoram_original.html">simdesign_ABCmcmc_Marjoram_original()</a></code>, <code><a href="../reference/simdesign_ABCmcmc_Wegmann.html">simdesign_ABCmcmc_Wegmann()</a></code>). Example 1 shows the process of how to use ABC with nlrx. Additionally, Latin Hypercube Sampling output can be used to calculate parameter distributions based on rejection sampling and local linear regression. Example 2 shows, how the <code><a href="../reference/simdesign_lhs.html">simdesign_lhs()</a></code> can be used in combination with the <a href="https://cran.r-project.org/package=abc">abc package</a>.</p>
<div id="example-1-approximate-bayesian-computation-with-monte-carlo-markov-chain" class="section level2">
<h2 class="hasAnchor">
<a href="#example-1-approximate-bayesian-computation-with-monte-carlo-markov-chain" class="anchor"></a>Example 1: Approximate bayesian computation with Monte-Carlo Markov-Chain</h2>
<p>Here we present one example for the widely used Marjoram algorithm which combines ABC with a Markov-Chain Monte-Carlo parameter sampling scheme. However, the other two ABCmcmc simdesigns work in a very similar way except for the parameter definitions within the simdesigns (see respective documentation pages for help).</p>
<p>We use the Wolf Sheep Predation model from the models library to show a basic example of the calibration workflow.</p>
<div id="step-1-create-a-nl-object" class="section level4">
<h4 class="hasAnchor">
<a href="#step-1-create-a-nl-object" class="anchor"></a>Step 1: Create a nl object:</h4>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/nlrx/">nlrx</a></span><span class="op">)</span>
<span class="co"># Windows default NetLogo installation path (adjust to your needs!):</span>
<span class="va">netlogopath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"C:/Program Files/NetLogo 6.0.3"</span><span class="op">)</span>
<span class="va">modelpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">netlogopath</span>, <span class="st">"app/models/Sample Models/Biology/Wolf Sheep Predation.nlogo"</span><span class="op">)</span>
<span class="va">outpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"C:/out"</span><span class="op">)</span>
<span class="co"># Unix default NetLogo installation path (adjust to your needs!):</span>
<span class="va">netlogopath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"/home/NetLogo 6.0.3"</span><span class="op">)</span>
<span class="va">modelpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">netlogopath</span>, <span class="st">"app/models/Sample Models/Biology/Wolf Sheep Predation.nlogo"</span><span class="op">)</span>
<span class="va">outpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"/home/out"</span><span class="op">)</span>

<span class="va">nl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nl.html">nl</a></span><span class="op">(</span>nlversion <span class="op">=</span> <span class="st">"6.0.3"</span>,
         nlpath <span class="op">=</span> <span class="va">netlogopath</span>,
         modelpath <span class="op">=</span> <span class="va">modelpath</span>,
         jvmmem <span class="op">=</span> <span class="fl">1024</span><span class="op">)</span></code></pre></div>
</div>
<div id="step-2-attach-an-experiment" class="section level4">
<h4 class="hasAnchor">
<a href="#step-2-attach-an-experiment" class="anchor"></a>Step 2: Attach an experiment</h4>
<p>Because we want to apply a calibration algorithm, we need to define proper variable ranges. The algorithm is allowed to change the values of these parameters within these ranges in order to reach our specified target values. Possible choices for the distribution type are qunif, qnorm, qlnorm and qexp. Each model run is evaluated for each specified metric within the metrics slot. When the simdesign is attached (see step 3) we will define target values for each metric. Thus, we should only enter metrics and reporters that should be used for calibrating the model.</p>
<p>For this simple example, we just want to check if we can find a parameterization that leads to a specific number of wolves and sheep after a runtime of 100 ticks. Thus, we define <code>count sheep</code> and <code>count wolves</code> as metrics, set the runtime to 100 and set tickmetrics to <code>false</code> (because we only want to measure the last simulation tick).</p>
<p>If more than one tick would be measured, the algorithm automatically calculates the mean value of the selected reporter over all measured ticks. If you wish to apply other functions to aggregate temporal information into one value, you can use a self-defined post-processing function when attaching the simdesign (see step 3).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nl</span><span class="op">@</span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/experiment.html">experiment</a></span><span class="op">(</span>expname<span class="op">=</span><span class="st">"wolf-sheep"</span>,
                            outpath<span class="op">=</span><span class="va">outpath</span>,
                            repetition<span class="op">=</span><span class="fl">1</span>,
                            tickmetrics<span class="op">=</span><span class="st">"false"</span>,
                            idsetup<span class="op">=</span><span class="st">"setup"</span>,
                            idgo<span class="op">=</span><span class="st">"go"</span>,
                            runtime<span class="op">=</span><span class="fl">100</span>,
                            metrics<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"count sheep"</span>, <span class="st">"count wolves"</span><span class="op">)</span>,
                            variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"sheep-gain-from-food"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>min<span class="op">=</span><span class="fl">2</span>, max<span class="op">=</span><span class="fl">6</span>, qfun<span class="op">=</span><span class="st">"qunif"</span><span class="op">)</span>,
                                             <span class="st">"wolf-gain-from-food"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>min<span class="op">=</span><span class="fl">10</span>, max<span class="op">=</span><span class="fl">30</span>, qfun<span class="op">=</span><span class="st">"qunif"</span><span class="op">)</span><span class="op">)</span>,
                            constants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">'initial-number-sheep'</span> <span class="op">=</span> <span class="fl">100</span>,
                                             <span class="st">'initial-number-wolves'</span> <span class="op">=</span> <span class="fl">50</span>,
                                             <span class="st">"grass-regrowth-time"</span> <span class="op">=</span> <span class="fl">30</span>,
                                             <span class="st">"sheep-reproduce"</span> <span class="op">=</span> <span class="fl">4</span>,
                                             <span class="st">"wolf-reproduce"</span> <span class="op">=</span> <span class="fl">5</span>,
                                             <span class="st">"model-version"</span> <span class="op">=</span> <span class="st">"\"sheep-wolves-grass\""</span>,
                                             <span class="st">"show-energy?"</span> <span class="op">=</span> <span class="st">"false"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="step-3-attach-a-simulation-design" class="section level4">
<h4 class="hasAnchor">
<a href="#step-3-attach-a-simulation-design" class="anchor"></a>Step 3: Attach a simulation design</h4>
<p>We use the <code><a href="../reference/simdesign_ABCmcmc_Marjoram.html">simdesign_ABCmcmc_Marjoram()</a></code> function to attach a calibration simdesign. The <code>summary_stat_target</code> represents the vector of our target values that we want to reach. These values corresponds to the defined metrics of the experiment and should have the same length and order. <code>n_rec</code> defines the number of samples and <code>n_calibration</code> defines the number of calibration runs. If this value is too low, a subscript out of bounds error message might appear. If <code>use_seed</code> is set to <code>TRUE</code>, the algorithm will automatically use a newly generated seed for each model run. If it is set to false, a user-specified seed (set in the <code><a href="../reference/run_nl_dyn.html">run_nl_dyn()</a></code> function) will be used instead. The <code>progress_bar</code> gives you expected runtime information during the execution of the algorithm. The nseeds command allows to generate a vector of random-seeds that may be used for setting model seeds.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nl</span><span class="op">@</span><span class="va">simdesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simdesign_ABCmcmc_Marjoram.html">simdesign_ABCmcmc_Marjoram</a></span><span class="op">(</span>nl<span class="op">=</span><span class="va">nl</span>,
                                           summary_stat_target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">80</span><span class="op">)</span>,
                                           n_rec <span class="op">=</span> <span class="fl">100</span>, 
                                           n_calibration<span class="op">=</span><span class="fl">200</span>,
                                           use_seed <span class="op">=</span> <span class="cn">TRUE</span>,
                                           progress_bar <span class="op">=</span> <span class="cn">TRUE</span>,
                                           nseeds <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
<p>These are the most important simdesign parameters, but there are many more to fine control the behavior of the algorithm. Check out the simdesign help page for more information. As already mentioned before, it is also possible to define a custom post-processing function. To apply this function for model output, the function name needs to be entered as <code>postpro_function</code> within the simdesign. For example, we might want to use the maximum value of some measured metrics to calibrate our model. Or maybe we want to run some tests and use the test statistics as calibration criterion. In such cases, we can define a function that accepts the nl object (with simulation results attached) as function input and returns a vector of numerics. This vector needs to represent the values that we defined as <code>sumary_stat_target</code> and thus should have the same length and order. Below is an example of a custom post-processing function that calculates the maximum value of selected metrics over all simulation ticks.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">post</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">nl</span><span class="op">)</span><span class="op">{</span>
  <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getsim.html">getsim</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"simoutput"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="../reference/getexp.html">getexp</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"metrics"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_each.html">summarise_each</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>max<span class="op">=</span><span class="va">max</span><span class="op">)</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">nl</span><span class="op">@</span><span class="va">simdesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simdesign_ABCmcmc_Marjoram.html">simdesign_ABCmcmc_Marjoram</a></span><span class="op">(</span>nl<span class="op">=</span><span class="va">nl</span>,
                                           postpro_function <span class="op">=</span> <span class="va">post</span>,
                                           summary_stat_target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">80</span><span class="op">)</span>,
                                           n_rec <span class="op">=</span> <span class="fl">100</span>, 
                                           n_calibration<span class="op">=</span><span class="fl">200</span>,
                                           use_seed <span class="op">=</span> <span class="cn">TRUE</span>,
                                           progress_bar <span class="op">=</span> <span class="cn">TRUE</span>,
                                           nseeds <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></code></pre></div>
</div>
<div id="step-4-run-simulations" class="section level4">
<h4 class="hasAnchor">
<a href="#step-4-run-simulations" class="anchor"></a>Step 4: Run simulations</h4>
<p>For calibration simdesigns, the <code><a href="../reference/run_nl_dyn.html">run_nl_dyn()</a></code> function lets you execute the simulations. There are some notable differences between <code><a href="../reference/run_nl_all.html">run_nl_all()</a></code> and <code><a href="../reference/run_nl_dyn.html">run_nl_dyn()</a></code>. First, because parameterizations depend of results from previous runs, <code><a href="../reference/run_nl_dyn.html">run_nl_dyn()</a></code> can not be parallelized. Second, the procedure does not automatically loop over created random seeds of the simdesign. If you want to repeat the same algorithm several times, just embed the <code><a href="../reference/run_nl_dyn.html">run_nl_dyn()</a></code> function in any kind of loop and iterate through the <code>nl@simdesign@simseeds</code> vector. We set the <code>use_seed</code> parameter of the simdesign to true, however we still need to define a random-seed in run_nl_dyn although it will be overwritten by the EasyABC functions.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_nl_dyn.html">run_nl_dyn</a></span><span class="op">(</span><span class="va">nl</span>, seed <span class="op">=</span> <span class="va">nl</span><span class="op">@</span><span class="va">simdesign</span><span class="op">@</span><span class="va">simseeds</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></code></pre></div>
</div>
<div id="step-5-investigate-output" class="section level4">
<h4 class="hasAnchor">
<a href="#step-5-investigate-output" class="anchor"></a>Step 5: Investigate output</h4>
<p>The output is reported as nested tibble which can be attached to the nl object. There are many possible ways to inspect the simulation output of the <code>ABCmcmc</code> functions. Below you find some guidance on how to summarize the output for calculating parameter statistics, sampling distributions, sampling density and exporting the best parameter combination.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/setsim&lt;-.html">setsim</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"simoutput"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">results</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">nl</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">nl</span><span class="op">@</span><span class="va">experiment</span><span class="op">@</span><span class="va">outpath</span>, <span class="st">"ABCmcmc.rds"</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Calculate descriptive statistics</span>
<span class="fu"><a href="../reference/getsim.html">getsim</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"simoutput"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># get simulation results from nl object</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">param</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># select param column</span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span>cols<span class="op">=</span><span class="va">param</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># unnest param column</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_each.html">summarise_each</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>min<span class="op">=</span><span class="va">min</span>, max<span class="op">=</span><span class="va">max</span>, mean<span class="op">=</span><span class="va">mean</span>, median<span class="op">=</span><span class="va">median</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># calculate statistics</span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">parameter</span>, <span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># convert to long format</span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span><span class="va">parameter</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"parameter"</span>, <span class="st">"stat"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># seperate parameter name and statistic</span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/spread.html">spread</a></span><span class="op">(</span><span class="va">stat</span>, <span class="va">value</span><span class="op">)</span> <span class="co"># convert back to wide format</span>

<span class="co">## Plot histogram of parameter sampling distribution:</span>
<span class="fu"><a href="../reference/getsim.html">getsim</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"simoutput"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># get simulation results from nl object</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">param</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># select param column</span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span>cols<span class="op">=</span><span class="va">param</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># unnest param column</span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">parameter</span>, <span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># convert to long format</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co"># plot histogram with a facet for each parameter</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">parameter</span>, scales<span class="op">=</span><span class="st">"free"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">value</span><span class="op">)</span>, bins <span class="op">=</span> <span class="fl">40</span><span class="op">)</span>

<span class="co">## Plot density of parameter sampling distribution:</span>
<span class="fu"><a href="../reference/getsim.html">getsim</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"simoutput"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># get simulation results from nl object</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">param</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># select param column</span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span>cols<span class="op">=</span><span class="va">param</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># unnest param column</span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">parameter</span>, <span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># convert to long format</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="co"># plot density with a facet for each parameter</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">parameter</span>, scales<span class="op">=</span><span class="st">"free"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">value</span>, fill<span class="op">=</span><span class="va">parameter</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Get best parameter combinations and corresponding function values</span>
<span class="fu"><a href="../reference/getsim.html">getsim</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"simoutput"</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># get simulation results from nl object</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">dist</span>,<span class="va">epsilon</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># select dist and epsilon columns</span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span>cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">dist</span>,<span class="va">epsilon</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>  <span class="co"># unnest dist and epsilon columns</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>runID<span class="op">=</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># add row ID column</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">dist</span> <span class="op">==</span> <span class="va">epsilon</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># only keep runs with dist=epsilon</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="fu"><a href="../reference/getsim.html">getsim</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"simoutput"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># join parameter values of best runs</span>
                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">param</span><span class="op">)</span> <span class="op">%&gt;%</span>
                     <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span>cols<span class="op">=</span><span class="va">param</span><span class="op">)</span> <span class="op">%&gt;%</span> 
                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>runID<span class="op">=</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="fu"><a href="../reference/getsim.html">getsim</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"simoutput"</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># join output values best runs</span>
                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">stats</span><span class="op">)</span> <span class="op">%&gt;%</span>
                     <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span>cols<span class="op">=</span><span class="va">stats</span><span class="op">)</span> <span class="op">%&gt;%</span> 
                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>runID<span class="op">=</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">runID</span>, <span class="va">dist</span>, <span class="va">epsilon</span>, <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="co"># update order of columns</span>

<span class="co">## Analyse mcmc using coda summary and plot functions:</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu">as.mcmc</span><span class="op">(</span><span class="fu"><a href="../reference/getsim.html">getsim</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"simoutput"</span><span class="op">)</span> <span class="op">%&gt;%</span>
                        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">param</span><span class="op">)</span> <span class="op">%&gt;%</span>
                        <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span>cols<span class="op">=</span><span class="va">param</span><span class="op">)</span><span class="op">)</span>, quantiles <span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0.05</span>,<span class="fl">0.95</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="fu">coda</span><span class="fu">::</span><span class="fu">as.mcmc</span><span class="op">(</span><span class="fu"><a href="../reference/getsim.html">getsim</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"simoutput"</span><span class="op">)</span> <span class="op">%&gt;%</span>
                        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">param</span><span class="op">)</span> <span class="op">%&gt;%</span>
                        <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/nest.html">unnest</a></span><span class="op">(</span>cols<span class="op">=</span><span class="va">param</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="example-2-using-latin-hypercube-sampling-for-approximate-bayesian-computation" class="section level2">
<h2 class="hasAnchor">
<a href="#example-2-using-latin-hypercube-sampling-for-approximate-bayesian-computation" class="anchor"></a>Example 2: Using Latin Hypercube Sampling for Approximate bayesian computation</h2>
<div id="step-1-create-a-nl-object-1" class="section level4">
<h4 class="hasAnchor">
<a href="#step-1-create-a-nl-object-1" class="anchor"></a>Step 1: Create a nl object:</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/nlrx/">nlrx</a></span><span class="op">)</span>
<span class="co"># Windows default NetLogo installation path (adjust to your needs!):</span>
<span class="va">netlogopath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"C:/Program Files/NetLogo 6.0.3"</span><span class="op">)</span>
<span class="va">modelpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">netlogopath</span>, <span class="st">"app/models/Sample Models/Biology/Wolf Sheep Predation.nlogo"</span><span class="op">)</span>
<span class="va">outpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"C:/out"</span><span class="op">)</span>
<span class="co"># Unix default NetLogo installation path (adjust to your needs!):</span>
<span class="va">netlogopath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"/home/NetLogo 6.0.3"</span><span class="op">)</span>
<span class="va">modelpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">netlogopath</span>, <span class="st">"app/models/Sample Models/Biology/Wolf Sheep Predation.nlogo"</span><span class="op">)</span>
<span class="va">outpath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="st">"/home/out"</span><span class="op">)</span>

<span class="va">nl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nl.html">nl</a></span><span class="op">(</span>nlversion <span class="op">=</span> <span class="st">"6.0.3"</span>,
         nlpath <span class="op">=</span> <span class="va">netlogopath</span>,
         modelpath <span class="op">=</span> <span class="va">modelpath</span>,
         jvmmem <span class="op">=</span> <span class="fl">1024</span><span class="op">)</span></code></pre></div>
</div>
<div id="step-2-attach-an-experiment-1" class="section level4">
<h4 class="hasAnchor">
<a href="#step-2-attach-an-experiment-1" class="anchor"></a>Step 2: Attach an experiment</h4>
<p>We want to run a Latin Hypercube sampling, thus we need to define proper variable ranges. We also need to define our output metrics. These metrics are also used for the rejection sampling later on.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nl</span><span class="op">@</span><span class="va">experiment</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/experiment.html">experiment</a></span><span class="op">(</span>expname<span class="op">=</span><span class="st">"wolf-sheep"</span>,
                            outpath<span class="op">=</span><span class="va">outpath</span>,
                            repetition<span class="op">=</span><span class="fl">1</span>,
                            tickmetrics<span class="op">=</span><span class="st">"false"</span>,
                            idsetup<span class="op">=</span><span class="st">"setup"</span>,
                            idgo<span class="op">=</span><span class="st">"go"</span>,
                            runtime<span class="op">=</span><span class="fl">100</span>,
                            metrics<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"count sheep"</span>, <span class="st">"count wolves"</span><span class="op">)</span>,
                            variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">"sheep-gain-from-food"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>min<span class="op">=</span><span class="fl">2</span>, max<span class="op">=</span><span class="fl">6</span>, qfun<span class="op">=</span><span class="st">"qunif"</span><span class="op">)</span>,
                                             <span class="st">"wolf-gain-from-food"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>min<span class="op">=</span><span class="fl">10</span>, max<span class="op">=</span><span class="fl">30</span>, qfun<span class="op">=</span><span class="st">"qunif"</span><span class="op">)</span><span class="op">)</span>,
                            constants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">'initial-number-sheep'</span> <span class="op">=</span> <span class="fl">100</span>,
                                             <span class="st">'initial-number-wolves'</span> <span class="op">=</span> <span class="fl">50</span>,
                                             <span class="st">"grass-regrowth-time"</span> <span class="op">=</span> <span class="fl">30</span>,
                                             <span class="st">"sheep-reproduce"</span> <span class="op">=</span> <span class="fl">4</span>,
                                             <span class="st">"wolf-reproduce"</span> <span class="op">=</span> <span class="fl">5</span>,
                                             <span class="st">"model-version"</span> <span class="op">=</span> <span class="st">"\"sheep-wolves-grass\""</span>,
                                             <span class="st">"show-energy?"</span> <span class="op">=</span> <span class="st">"false"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="step-3-attach-a-simulation-design-1" class="section level4">
<h4 class="hasAnchor">
<a href="#step-3-attach-a-simulation-design-1" class="anchor"></a>Step 3: Attach a simulation design</h4>
<p>We use the <code><a href="../reference/simdesign_lhs.html">simdesign_lhs()</a></code> helper function to generate a Latin Hypercube Sampling with 500 samples</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nl</span><span class="op">@</span><span class="va">simdesign</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simdesign_lhs.html">simdesign_lhs</a></span><span class="op">(</span><span class="va">nl</span>, 
                              samples<span class="op">=</span><span class="fl">500</span>, 
                              nseeds<span class="op">=</span><span class="fl">1</span>, 
                              precision<span class="op">=</span><span class="fl">3</span><span class="op">)</span></code></pre></div>
</div>
<div id="step-4-run-simulations-1" class="section level4">
<h4 class="hasAnchor">
<a href="#step-4-run-simulations-1" class="anchor"></a>Step 4: Run simulations</h4>
<p>We can simply use <code><a href="../reference/run_nl_all.html">run_nl_all()</a></code> to execute our simulations.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_nl_all.html">run_nl_all</a></span><span class="op">(</span><span class="va">nl</span><span class="op">)</span></code></pre></div>
</div>
<div id="step-5-investigate-output-1" class="section level4">
<h4 class="hasAnchor">
<a href="#step-5-investigate-output-1" class="anchor"></a>Step 5: Investigate output</h4>
<p>We first attach the output results to our nl object and store a copy of the nl object on disk.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/setsim&lt;-.html">setsim</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"simoutput"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">results</span>
<span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">nl</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html">file.path</a></span><span class="op">(</span><span class="va">nl</span><span class="op">@</span><span class="va">experiment</span><span class="op">@</span><span class="va">outpath</span>, <span class="st">"ABClhs.rds"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>For post-processing, we need a tibble with input parameter distributions. This can be easily extracted from the <code>siminput</code> slot of the <code>simdesign</code> by selecting only the columns with variable (non-constant) parameters. Next, we need corresponding outputs for these parameters. In this example we just take the measured output tibble (<code>simoutput</code>) and only select the columns with our metrics. Of course, you can also perform additional post-processing of these outputs if desired. Third, we need to define expected values for our outputs. In our case, we just assume that <code>count sheep</code> should have a value of 100, whereas <code>count wolves</code> should have a value of 80.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">input</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getsim.html">getsim</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"siminput"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="fu"><a href="../reference/getexp.html">getexp</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"variables"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getsim.html">getsim</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"simoutput"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="fu"><a href="../reference/getexp.html">getexp</a></span><span class="op">(</span><span class="va">nl</span>, <span class="st">"metrics"</span><span class="op">)</span><span class="op">)</span>
<span class="va">target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"count sheep"</span><span class="op">=</span><span class="fl">100</span>, <span class="st">"count wolves"</span><span class="op">=</span><span class="fl">80</span><span class="op">)</span></code></pre></div>
<p>We use the <code>abc</code> function of the <a href="https://cran.r-project.org/package=abc">abc package</a> to perform the rejection sampling. For this example, we perform both algorithms provided by this function (“rejection” and “loclinear”).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results.abc.reject</span> <span class="op">&lt;-</span> <span class="fu">abc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/abc/man/abc.html">abc</a></span><span class="op">(</span>target<span class="op">=</span><span class="va">target</span>, 
                        param<span class="op">=</span><span class="va">input</span>,
                        sumstat<span class="op">=</span><span class="va">output</span>,
                        tol<span class="op">=</span><span class="fl">0.3</span>, 
                        method<span class="op">=</span><span class="st">"rejection"</span><span class="op">)</span>

<span class="va">results.abc.loclin</span> <span class="op">&lt;-</span> <span class="fu">abc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/abc/man/abc.html">abc</a></span><span class="op">(</span>target<span class="op">=</span><span class="va">target</span>, 
                               param<span class="op">=</span><span class="va">input</span>,
                               sumstat<span class="op">=</span><span class="va">output</span>,
                               tol<span class="op">=</span><span class="fl">0.3</span>, 
                               method<span class="op">=</span><span class="st">"loclinear"</span><span class="op">)</span></code></pre></div>
<p>Finally, we might want to compare the accepted parameter distributions of both algorithms and the initial distribution of the Latin Hypercube sampling. Thus, we reformat the results to a tidy data format and attach the initial parameter distributions. This dataset can now be used for displaying the parameter distributions with ggplot.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results.abc.all</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">results.abc.reject</span><span class="op">$</span><span class="va">unadj.values</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># results from rejection method</span>
  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">parameter</span>, <span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"rejection"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="va">results.abc.loclin</span><span class="op">$</span><span class="va">adj.values</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="co"># results from local linear regression method</span>
                     <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">parameter</span>, <span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span> 
                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"loclinear"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_rows</a></span><span class="op">(</span><span class="va">input</span> <span class="op">%&gt;%</span>                <span class="co"># initial parameter distribution (lhs)</span>
                     <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html">gather</a></span><span class="op">(</span><span class="va">parameter</span>, <span class="va">value</span><span class="op">)</span> <span class="op">%&gt;%</span> 
                     <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">"lhs"</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">results.abc.all</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span><span class="va">method</span><span class="op">~</span><span class="va">parameter</span>, scales<span class="op">=</span><span class="st">"free"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html">geom_histogram</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">value</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">results.abc.all</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">parameter</span>, scales<span class="op">=</span><span class="st">"free"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">value</span>, fill<span class="op">=</span><span class="va">method</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jan Salecker, Marco Sciaini, Sebastian Hanss.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
